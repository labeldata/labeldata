{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‘œì‹œì‚¬í•­ ì‘ì„±</title>

    <!-- Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    {% comment %} <style>
        /* ì»¨í…Œì´ë„ˆ ì „ì²´ ë†’ì´ ì§€ì • */
        .container-fluid {
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ì¢Œìš° ë¶„í•  í™”ë©´ */
        .left-panel, .right-panel {
            height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        /* ì¢Œìš° ë¹„ìœ¨ ì„¤ì • (ê¸°ë³¸ê°’ 50:50) */
        .left-panel {
            flex: 1;
            background-color: #f8f9fa;
        }

        .right-panel {
            flex: 1;
            background-color: #ffffff;
        }

        /* ì¤‘ê°„ ë“œë˜ê·¸ë°” */
        .drag-bar {
            width: 5px;
            heigth: 100vh;
            background-color: #ccc;
            cursor: ew-resize;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container-fluid {
                flex-direction: row;
            }
            .drag-bar {
                height: 5px;
                width: 100%;
                cursor: ns-resize;
            }
        }
    </style> {% endcomment %}
</head>
<body>

    <div class="container-fluid">
        <!-- ì¢Œì¸¡ ë°ì´í„° ì…ë ¥ -->
        <div class="left-panel">
            <h4>ğŸ“ ë°ì´í„° ì…ë ¥í•˜ê¸°</h4>
            <hr>
            <form method="post">
                {% csrf_token %}
                <div class="form-group mb-3">
                    <label for="prdlst_report_no" class="form-label">í’ˆëª©ì œì¡°ë²ˆí˜¸</label>
                    <input type="text" name="prdlst_report_no" class="form-control" value="{{ form.prdlst_report_no.value }}" readonly>
                </div>
                <div class="form-group mb-3">
                    <label for="prdlst_nm" class="form-label">ì œí’ˆëª…</label>
                    <input type="text" name="prdlst_nm" class="form-control" value="{{ form.prdlst_nm.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="prdlst_dcnm" class="form-label">í’ˆëª©ìœ í˜•ëª…</label>
                    <input type="text" name="prdlst_dcnm" class="form-control" value="{{ form.prdlst_dcnm.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="bssh_nm" class="form-label">ì œì¡°ì‚¬ëª…</label>
                    <input type="text" name="bssh_nm" class="form-control" value="{{ form.bssh_nm.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="rawmtrl_nm" class="form-label">ì›ì¬ë£Œëª…</label>
                    <textarea name="rawmtrl_nm" class="form-control" rows="3">{{ form.rawmtrl_nm.value }}</textarea>
            <!-- ì•Œë ˆë¥´ê¸° ë¬¼ì§ˆ ì„ íƒ -->
            <div class="form-group mb-3">
                <label>ì•Œë ˆë¥´ê¸° ë¬¼ì§ˆ</label>
                <div class="border p-2 d-flex flex-wrap gap-3">
                    {% for allergen in allergens %}
                    <div class="form-check" style="flex: 1 1 calc(33.33% - 10px);">
                        <input class="form-check-input allergy-checkbox"
                            type="checkbox" name="allergens" value="{{ allergen.id }}"
                            id="allergy-{{ allergen.id }}"
                            {% if allergen in form.allergens.value %}checked{% endif %}>
                        <label class="form-check-label" for="allergy-{{ allergen.id }}">{{ allergen.name }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
                <div class="form-group mb-3">
                    <label for="storage_method" class="form-label">ë³´ê´€ë°©ë²•</label>
                    <textarea name="storage_method" class="form-control" rows="3">{{ form.storage_method.value }}</textarea>
                </div>
                <div class="form-group mb-3">
                    <label for="content_weight" class="form-label">ë‚´ìš©ëŸ‰(ì—´ëŸ‰)</label>
                    <input type="text" name="content_weight" class="form-control" value="{{ form.content_weight.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="manufacturer_address" class="form-label">ì œì¡°ì› ì†Œì¬ì§€</label>
                    <input type="text" name="manufacturer_address" class="form-control" value="{{ form.manufacturer_address.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="origin" class="form-label">ì›ì‚°ì§€</label>
                    <input type="text" name="origin" class="form-control" value="{{ form.origin.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="importer_address" class="form-label">ìˆ˜ì…ì› ë° ì†Œì¬ì§€</label>
                    <input type="text" name="importer_address" class="form-control" value="{{ form.importer_address.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="distributor_name" class="form-label">ìœ í†µì „ë¬¸íŒë§¤ì›</label>
                    <input type="text" name="distributor_name" class="form-control" value="{{ form.distributor_name.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="distributor_address" class="form-label">ìœ í†µì „ë¬¸íŒë§¤ì› ì†Œì¬ì§€</label>
                    <input type="text" name="distributor_address" class="form-control" value="{{ form.distributor_address.value }}">
                </div>
                <div class="form-group mb-3">
                    <label for="warnings" class="form-label">ì£¼ì˜ì‚¬í•­</label>
                    <textarea name="warnings" class="form-control" rows="3">{{ form.warnings.value }}</textarea>
                </div>
                <div class="form-group mb-3">
                    <label for="additional_info" class="form-label">ê¸°íƒ€ í‘œì‹œì‚¬í•­</label>
                    <textarea name="additional_info" class="form-control" rows="3">{{ form.additional_info.value }}</textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">ì €ì¥</button>
            </form>
        </div>

        <!-- ì¤‘ê°„ ë“œë˜ê·¸ë°” -->
        <div class="drag-bar" id="drag-bar"></div>

        <!-- ìš°ì¸¡ í‘œì‹œì‚¬í•­ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="right-panel">
            <h4>ğŸ“‹ ë¯¸ë¦¬ë³´ê¸°</h4>
            <hr>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©ëª…</th>
                        <th>ë‚´ìš©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for field in form %}
                        <!-- ì•Œë ˆë¥´ê¸° ë¬¼ì§ˆ ë¯¸ë¦¬ë³´ê¸°ë¥¼ íŠ¹ì • ìœ„ì¹˜ì— ì‚½ì… -->
                        {% if field.name == "storage_method" %}  {# ì›í•˜ëŠ” ìœ„ì¹˜ ì§€ì • #}
                            <tr class="allergy-box d-none">
                                <td><strong>ì•Œë ˆë¥´ê¸° ì£¼ì˜</strong></td>
                                <td id="allergy-preview"></td>
                            </tr>
                        {% endif %}
                
                        <tr>
                            <td>{{ field.label }}</td>
                            <td><span id="preview-{{ field.name }}">{{ field.value }}</span></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        function updatePreview() {
            document.querySelectorAll("input, textarea").forEach(input => {
                const previewElement = document.getElementById("preview-" + input.name);
                if (previewElement) {
                    previewElement.textContent = input.value;
                }
            });

            // âœ… ì•Œë ˆë¥´ê¸° ë¬¼ì§ˆ ì„ íƒ ë°˜ì˜
            const selectedAllergens = Array.from(document.querySelectorAll(".allergy-checkbox:checked"))
                                          .map(cb => cb.nextElementSibling.textContent);
            const allergyPreview = document.getElementById("allergy-preview");
            const allergyBox = document.querySelector(".allergy-box");

            if (selectedAllergens.length > 0) {
                allergyPreview.textContent = selectedAllergens.join(", ") + " í•¨ìœ ";
                allergyBox.classList.remove("d-none");
            } else {
                allergyPreview.textContent = "";
                allergyBox.classList.add("d-none");
            }
        }

        document.querySelectorAll("input, textarea, .allergy-checkbox").forEach(input => {
            input.addEventListener("input", updatePreview);
        });

        updatePreview();
    });

    document.addEventListener("DOMContentLoaded", function () {
    const leftPanel = document.querySelector(".left-panel");
    const rightPanel = document.querySelector(".right-panel");
    const dragBar = document.getElementById("drag-bar");

    let isDragging = false;

    dragBar.addEventListener("mousedown", (e) {
        isDragging = true;
        document.body.style.cursor = "ew-resize";
    });

    document.addEventListener("mousemove", (e){
        if (!isDragging) return;

        const containerWidth = document.querySelector(".container-fluid").offsetWidth;
        const newLeftWidth = e.clientX / containerWidth * 100;
        const minWidth = 25;
        const maxWidth = 75;

        if (newLeftWidth >= minWidth && newLeftWidth <= maxWidth) {
            leftPanel.style.flex = `0 0 ${newLeftWidth}%`;
            rightPanel.style.flex = `0 0 ${100 - newLeftWidth}%`;
        }
    });

    document.addEventListener("mouseup", () {
        isDragging = false;
        document.body.style.cursor = "default";
    });
}); 
    </script>
