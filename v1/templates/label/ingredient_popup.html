{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ì›ì¬ë£Œ ìƒì„¸ ì •ë³´</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Sortable JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/popup.css' %}?v={{ STATIC_BUILD_DATE }}">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
            word-break: break-all;
        }
        .styled-table th {
            background-color: #f8f9fa;
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
        }
        .table-container {
            margin-top: 10px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .table-container .table-responsive {
            overflow-y: auto;
        }
        .modal-readonly-field {
            background-color: #e9ecef;
        }
        
        /* ëª¨ë‹¬ ì „ìš© ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        #modalSearchInput1, #modalSearchInput2, #modalSearchInput3, #modalSearchInput4, #modalSearchInputFoodCategory {
            height: 38px;
            font-size: var(--font-size-base);
        }
        
        /* Select2 ìŠ¤íƒ€ì¼ ì¡°ì • */
        .select2-container--default .select2-selection--single {
            height: 38px !important;
            border-radius: 6px !important;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 36px !important;
        }
        
        /* ëª¨ë‹¬ ê²€ìƒ‰ ê²°ê³¼ ì½ê¸° ì „ìš© í•„ë“œ */
        #modalSearchResults input,
        #modalSearchResults select,
        #modalSearchResults textarea {
            pointer-events: none;
            background-color: var(--bg-muted) !important;
        }
        
        /* ì•Œë ˆë¥´ê¸°/GMO ë§í¬ ìŠ¤íƒ€ì¼ */
        .allergen-gmo-link {
            color: var(--secondary-color);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 500;
        }
        
        .allergen-gmo-link:hover {
            color: var(--primary-color);
        }
    </style>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap Icons (for X icon) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="ingredient-popup">
<div class="container-fluid popup-container" data-has-relations="{{ has_relations|yesno:'true,false' }}">
    <!-- ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸: ë‚´ ì›ë£Œ ê²€ìƒ‰ -->
    <div class="modal fade" id="ingredientSearchModal" tabindex="-1" aria-labelledby="ingredientSearchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);">
                <div class="modal-header" style="background-color: #f8f9fa; border-bottom: 1px solid #e5e7eb; border-radius: 12px 12px 0 0; padding: 20px;">
                    <div class="w-100">
                        <div class="d-flex align-items-center" style="gap: 6px; flex-wrap: nowrap;">
                            <span class="modal-title" id="ingredientSearchModalLabel" style="font-size: 1rem; font-weight: 600; color: #1f2937; white-space: nowrap;">ğŸ” ì›ë£Œ ê²€ìƒ‰</span>
                            <select id="modalSearchInputFoodCategory" class="form-select" style="width: 100px; height: 36px; font-size: 0.85rem;"></select>
                            <select id="modalSearchInput3" class="form-select" style="width: 100px; height: 36px; font-size: 0.85rem;"></select>
                            <input type="text" id="modalSearchInput1" class="form-control" placeholder="ì›ì¬ë£Œëª…" style="width: 110px; height: 36px; font-size: 0.85rem;">
                            <input type="text" id="modalSearchInput2" class="form-control" placeholder="í’ˆëª©ë³´ê³ ë²ˆí˜¸" style="width: 125px; height: 36px; font-size: 0.85rem;">
                            <input type="text" id="modalSearchInput4" class="form-control" placeholder="ì œì¡°ì‚¬" style="width: 100px; height: 36px; font-size: 0.85rem;">
                            <input type="text" id="modalSearchInputAllergen" class="form-control" placeholder="ì•Œë ˆë¥´ê¸°" style="width: 85px; height: 36px; font-size: 0.85rem;">
                            <input type="text" id="modalSearchInputGmo" class="form-control" placeholder="GMO" style="width: 70px; height: 36px; font-size: 0.85rem;">
                            <button type="button" class="btn btn-primary search-btn" onclick="searchMyIngredientInModal()" style="margin-left: auto; height: 36px; min-width: 60px; width: 70px;">
                                ê²€ìƒ‰
                            </button>
                            <button type="button" class="modal-close-btn" data-bs-dismiss="modal" aria-label="ë‹«ê¸°" style="height: 36px; min-width: 60px; width: 70px;">
                                <i class="bi bi-x-lg"></i> ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-body" style="padding: 20px; background-color: #ffffff;">
                    <div id="modalSearchResults" style="margin-top: 15px;">
                        <div class="list-group-item search-result-header d-none" id="searchResultsHeader" style="background-color: #e5e7eb; color: #1f2937; border-radius: 8px; border: 1px solid #d1d5db; padding: 15px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex flex-grow-1">
                                    <div class="flex-fill"><strong>ì‹í’ˆêµ¬ë¶„</strong></div>
                                    <div class="flex-fill"><strong>ì‹í’ˆìœ í˜•</strong></div>
                                    <div class="flex-fill"><strong>ì›ì¬ë£Œëª…</strong></div>
                                    <div class="flex-fill"><strong>í’ˆëª©ë³´ê³ ë²ˆí˜¸</strong></div>
                                    <div class="flex-fill"><strong>ì œì¡°ì‚¬</strong></div>
                                </div>
                                <div style="width: 100px;" class="text-end"><strong>í–‰ë™</strong></div>
                            </div>
                            <div class="mt-2">
                                <strong>ì›ì¬ë£Œ í‘œì‹œëª…</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê¸°ì¡´ ì›ë£Œ ì¡°íšŒ ëª¨ë‹¬ -->
    <div class="modal fade" id="existing-ingredients-modal" tabindex="-1" aria-labelledby="existingIngredientsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="border: 1px solid #ced4da; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
                <div class="modal-header" style="background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; border-radius: 8px 8px 0 0;">
                    <h5 class="modal-title" id="existingIngredientsModalLabel">ì›ë£Œ ì¡°íšŒ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
                </div>
                <div class="modal-body" id="existing-ingredients-modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success me-2" onclick="registerNewIngredient()">
                        <i class="bi bi-plus-circle"></i> ì‹ ê·œ ë“±ë¡
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-lg"></i> ë‹«ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì½ê¸° ì „ìš© ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal fade" id="readOnlyInfoModal" tabindex="-1" aria-labelledby="readOnlyInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="readOnlyInfoModalLabel">ì •ë³´ ë³´ê¸°</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6 id="infoIngredientName" class="mb-3"></h6>
                    <div id="infoContent" class="mb-2"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë ˆë¥´ê¸°/GMO ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal fade" id="allergenGmoDetailModal" tabindex="-1" aria-labelledby="allergenGmoDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="allergenGmoDetailModalLabel">ìƒì„¸ ì •ë³´</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr id="allergenGmoTableHeader">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í—¤ë” -->
                                </tr>
                            </thead>
                            <tbody id="allergenGmoTableBody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë‚´ìš© -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¹ ë¥¸ ì›ë£Œ ë“±ë¡ ëª¨ë‹¬ -->
    <div class="modal fade" id="quickRegisterModal" tabindex="-1" aria-labelledby="quickRegisterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);">
                <div class="modal-header" style="background-color: #f8f9fa; border-bottom: 1px solid #e5e7eb; border-radius: 12px 12px 0 0;">
                    <h5 class="modal-title" id="quickRegisterModalLabel" style="color: #1f2937; font-weight: 600;">
                        <i class="bi bi-plus-circle"></i> ë¹ ë¥¸ ì›ë£Œ ë“±ë¡
                    </h5>
                    <div>
                        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                            <i class="bi bi-x-lg"></i> ì·¨ì†Œ
                        </button>
                        <button type="button" class="btn btn-success btn-sm" onclick="submitQuickRegister()">
                            <i class="bi bi-check-lg"></i> ë“±ë¡
                        </button>
                    </div>
                </div>
                <div class="modal-body" style="padding: 24px;">
                    <div class="alert alert-info" style="border-radius: 8px; background-color: #e7f3ff; border: 1px solid #b3d9ff;">
                        <i class="bi bi-info-circle"></i> ìµœì†Œí•œì˜ ì •ë³´ë§Œ ì…ë ¥í•˜ì—¬ ë¹ ë¥´ê²Œ ë“±ë¡í•©ë‹ˆë‹¤. ìƒì„¸ ì •ë³´ëŠ” ë‚˜ì¤‘ì— "ë‚´ ì›ë£Œ ê´€ë¦¬"ì—ì„œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                    <form id="quickRegisterForm">
                        <div class="mb-3">
                            <label for="quickIngredientName" class="form-label">ì›ì¬ë£Œëª… <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="quickIngredientName" required placeholder="ì˜ˆ: ë°€ê°€ë£¨">
                        </div>
                        <div class="mb-3">
                            <label for="quickDisplayName" class="form-label">ì›ì¬ë£Œ í‘œì‹œëª…</label>
                            <input type="text" class="form-control" id="quickDisplayName" placeholder="ì˜ˆ: ë°€ê°€ë£¨(êµ­ë‚´ì‚°) (ë¹„ì›Œë‘ë©´ ì›ì¬ë£Œëª…ê³¼ ë™ì¼)">
                            <small class="text-muted">ì›ì¬ë£Œëª…ê³¼ ë‹¤ë¥´ê²Œ í‘œì‹œí•˜ê³  ì‹¶ì„ ë•Œ ì…ë ¥í•˜ì„¸ìš”.</small>
                        </div>
                        <div class="mb-3">
                            <label for="quickFoodCategory" class="form-label">ì‹í’ˆêµ¬ë¶„ <span class="text-danger">*</span></label>
                            <select class="form-select" id="quickFoodCategory" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="processed">ê°€ê³µì‹í’ˆ</option>
                                <option value="agricultural">ë†ìˆ˜ì‚°ë¬¼</option>
                                <option value="additive">ì‹í’ˆì²¨ê°€ë¬¼</option>
                                <option value="ì •ì œìˆ˜">ì •ì œìˆ˜</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="quickFoodType" class="form-label">ì‹í’ˆìœ í˜• <span class="text-danger">*</span></label>
                            <select class="form-select" id="quickFoodType" required>
                                <option value="">ì‹í’ˆêµ¬ë¶„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="quickManufacturer" class="form-label">ì œì¡°ì‚¬</label>
                            <input type="text" class="form-control" id="quickManufacturer" placeholder="ì˜ˆ: ãˆœëŒ€í•œì œë¶„">
                        </div>
                        <div class="mb-3">
                            <label for="quickReportNo" class="form-label">í’ˆëª©ë³´ê³ ë²ˆí˜¸</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="quickReportNo" placeholder="ì˜ˆ: 19950000000000" maxlength="15">
                                <button type="button" class="btn btn-outline-primary" onclick="fetchFoodItemForQuickRegister()" title="í’ˆëª©ë³´ê³ ë²ˆí˜¸ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°">
                                    <i class="bi bi-download"></i> ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                            </div>
                            <small class="text-muted">í’ˆëª©ë³´ê³ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ í´ë¦­í•˜ë©´ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.</small>
                        </div>
                        
                        <!-- ì•Œë ˆë¥´ê¸° ì„ íƒ -->
                        <div class="mb-2">
                            <label class="form-label" style="font-size: 0.9rem; font-weight: 600;">ì•Œë ˆë¥´ê¸° ë¬¼ì§ˆ</label>
                            <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; background-color: #f8f9fa;">
                                <div id="quickAllergenDisplay" class="mb-2" style="min-height: 24px; font-size: 0.8rem; color: #6b7280;">
                                    ì„ íƒëœ í•­ëª© ì—†ìŒ
                                </div>
                                <div class="d-flex flex-wrap gap-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì•Œë¥˜" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì•Œë¥˜</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ìš°ìœ " style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ìš°ìœ </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë©”ë°€" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë©”ë°€</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë•…ì½©" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë•…ì½©</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ëŒ€ë‘" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ëŒ€ë‘</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë°€" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë°€</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ê³ ë“±ì–´" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ê³ ë“±ì–´</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ê²Œ" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ê²Œ</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ìƒˆìš°" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ìƒˆìš°</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë¼ì§€ê³ ê¸°" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë¼ì§€ê³ ê¸°</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë³µìˆ™ì•„" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë³µìˆ™ì•„</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="í† ë§ˆí† " style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">í† ë§ˆí† </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì•„í™©ì‚°ë¥˜" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì•„í™©ì‚°ë¥˜</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="í˜¸ë‘" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">í˜¸ë‘</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì£" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì£</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ë‹­ê³ ê¸°" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë‹­ê³ ê¸°</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì‡ ê³ ê¸°" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì‡ ê³ ê¸°</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì˜¤ì§•ì–´" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì˜¤ì§•ì–´</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-allergen-btn" data-allergen="ì¡°ê°œë¥˜" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì¡°ê°œë¥˜</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- GMO ì„ íƒ -->
                        <div class="mb-2">
                            <label class="form-label" style="font-size: 0.9rem; font-weight: 600;">GMO</label>
                            <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; background-color: #f8f9fa;">
                                <div id="quickGmoDisplay" class="mb-2" style="min-height: 24px; font-size: 0.8rem; color: #6b7280;">
                                    ì„ íƒëœ í•­ëª© ì—†ìŒ
                                </div>
                                <div class="d-flex flex-wrap gap-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ëŒ€ë‘" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ëŒ€ë‘</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ì˜¥ìˆ˜ìˆ˜" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì˜¥ìˆ˜ìˆ˜</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ë©´í™”" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë©´í™”</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ì¹´ë†€ë¼" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì¹´ë†€ë¼</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ì‚¬íƒ•ë¬´" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì‚¬íƒ•ë¬´</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary quick-gmo-btn" data-gmo="ì•ŒíŒ”íŒŒ" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ì•ŒíŒ”íŒŒ</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒë‹¨ íˆ´ë°” -->
    <div class="popup-header">
        <div style="flex-grow: 1;">
            <div class="popup-title">
                ì›ì¬ë£Œ ìƒì„¸ ì •ë³´
            </div>
            <p class="mb-0" style="font-size: 0.75rem; color: #6c757d; margin-top: 4px;">
                ë“±ë¡ëœ ì›ë£Œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€í•˜ê³ , ë¹„ìœ¨ì„ ì…ë ¥í•˜ë©´ ì›ì¬ë£Œ í‘œì‹œëª…ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
            </p>
        </div>
        <div class="action-buttons">
            <button type="button" class="btn btn-primary btn-sm" onclick="saveIngredients()">
                <i class="bi bi-file-earmark-arrow-down"></i> ì €ì¥
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.close()">
                <i class="bi bi-x-lg"></i> ë‹«ê¸°
            </button>
        </div>
    </div>
    <hr>

    <!-- ìš”ì•½ ì„¹ì…˜ -->
    <div class="summary-section">
        <p><span class="fw-bold">ì›ì¬ë£Œ í‘œì‹œëª…:</span> <span id="summary-display-names">ì—†ìŒ</span></p>
        <p><span class="fw-bold">ì•Œë ˆë¥´ê¸°/GMO ì„±ë¶„:</span> <span id="summary-allergens-gmo">ì—†ìŒ</span></p>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="d-flex align-items-center" style="gap: 8px;">
                <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#ingredientSearchModal" title="ì´ë¯¸ ë“±ë¡ëœ ì›ë£Œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€">
                    <i class="bi bi-search"></i> ë“±ë¡ ì›ë£Œ ê²€ìƒ‰
                </button>
                <button type="button" class="btn btn-outline-success btn-sm" onclick="openQuickRegisterModal()" title="ë“±ë¡ë˜ì§€ ì•Šì€ ì›ë£Œë¥¼ ë¹ ë¥´ê²Œ ë“±ë¡">
                    <i class="bi bi-plus-circle"></i> ì‹ ê·œ ì›ë£Œ ë“±ë¡
                </button>
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeSelectedRows()" title="ì„ íƒí•œ ì›ë£Œë¥¼ ëª©ë¡ì—ì„œ ì‚­ì œ">
                    <i class="bi bi-trash"></i> ì„ íƒ ì›ë£Œ ì‚­ì œ
                </button>
            </div>
            <!-- [ì¶”ê°€] ì´ ë¹„ìœ¨ í‘œì‹œ ì˜ì—­ -->
            <div id="ratio-sum-container" class="h6 mb-0">
                ì´ ë¹„ìœ¨: <span id="ratio-sum">0.00</span>%
            </div>
        </div>
        <div class="table-responsive">
            <table class="table styled-table table-hover">
                <thead>
                    <tr>
                        <th style="width: 2%;"><input type="checkbox" id="select-all" class="form-check-input" /></th>
                        <th style="width: 2%;">ìˆœì„œ</th>
                        <th style="width: 18%;">ì›ì¬ë£Œëª…</th>
                        <th style="width: 8%;">ë¹„ìœ¨(%)</th>
                        <th style="width: 10%;">ì‹í’ˆêµ¬ë¶„</th>
                        <th style="width: 13%;">ì‹í’ˆìœ í˜•</th>
                        <th style="width: 35%;">ì›ì¬ë£Œ í‘œì‹œëª…<br><small class="text-muted">(ìš”ì•½ ê·œì¹™: ì‹í’ˆìœ í˜• or ì›ì¬ë£Œëª… + 5% ì´ìƒ ì‹œ ë³µí•©ì›ì¬ë£Œ í‘œì‹œ)</small></th>
                        <th style="width: 12%;">ì›ì‚°ì§€ í‘œì‹œ ê²€ì¦</th>
                    </tr>
                </thead>
                <tbody id="ingredient-body"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{{ saved_ingredients|json_script:"saved-ingredients-data" }}
{{ country_names|json_script:"country-names-data" }}
{{ food_types|json_script:"food-types-data" }}
{{ agricultural_products|json_script:"agricultural-products-data" }}
{{ food_additives|json_script:"food-additives-data" }}
<script src="{% static 'js/label/ingredient_popup.js' %}?v={{ STATIC_BUILD_DATE }}"></script>
</body>
</html>