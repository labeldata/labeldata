<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>라벨 미리보기</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100..900&display=swap" rel="stylesheet">
  <link href="{% static 'css/popup.css' %}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-beautiful-dnd@13/dist/react-beautiful-dnd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/label/label_preview.js' %}"></script>
  <style>
  .preview-container {
    min-height: 500px;
    display: flex;
    gap: 20px;
  }

  .settings-panel {
    flex: 0 0 200px;  /* 300px에서 200px로 축소 */
    padding: 15px;
    border-right: 1px solid #dee2e6;
  }

  .settings-item {
    margin-bottom: 10px; /* 간격 조정 */
    width: 100%;        /* 전체 너비 사용 */
  }

  /* 설정 입력칸 세로 배치 스타일 */
  .settings-row {
    display: block;     /* flex에서 block으로 변경 */
    margin-bottom: 15px;
  }

  .area-info {
    text-align: right;
    color: #6c757d;
    font-size: 0.9rem;
    margin: 5px 0;
  }

  /* 테이블 스타일 추가 */
  .preview-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
  }
  
  .preview-table th,
  .preview-table td {
    border: 1px solid #dee2e6;
    padding: 8px;
  }
  
  .preview-table th {
    background-color: #f8f9fa;
    width: 120px;  /* 항목명 너비 고정 */
    text-align: center;
  }
  
  .preview-table td {
    width: auto;  /* 나머지 공간 자동 조정 */
  }
  
  /* 헤더/푸터 텍스트 스타일 */
  .header-text {
    text-align: center;
    font-size: 14pt;
    font-weight: bold;
    margin-bottom: 1rem;
  }
  
  .footer-text {
    text-align: right;
    font-size: 8pt;
    color: #6c757d;
    margin-top: 1rem;
  }

  .preview-header-box {
    background-color: var(--primary-color);
    color: white;
    padding: 8px 12px;
    margin-bottom: 0;  /* 표와의 간격 제거 */
    display: inline-block;  /* 컨텐츠에 맞게 너비 조절 */
    width: 100%;  /* 전체 너비 사용 */
}

.preview-header-box .header-text {
    margin: 0;  /* 마진 제거 */
    line-height: 1.2;  /* 줄간격 최소화 */
}

.preview-table {
    margin-top: 0;  /* 상단 마진 제거 */
}

/* 헤더 스타일 수정 */
.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px 15px;
    border-bottom: 1px solid #dee2e6;
    background-color: #f8f9fa;
}

.preview-title {
    font-size: 1.2rem;
    font-weight: 500;
    margin: 0;
}

.preview-actions {
    display: flex;
    gap: 8px;
}

/* 미리보기 영역 자동 조절 스타일 수정 */
.preview-panel {
    flex: 1;
    padding: 15px;
    overflow: visible;  /* 스크롤 제거 */
}

.preview-content {
    border: 1px solid #dee2e6;
    padding: 20px;
    min-height: 400px;
    height: auto;
    width: auto;
    overflow: visible;  /* 스크롤 제거 */
}
  </style>
  <!-- 폰트 추가 -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Myeongjo:wght@400;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<!-- 헤더 구조 수정 -->
<div class="preview-header">
    <div class="preview-title">미리보기</div>
    <div class="preview-actions">
        <button class="btn btn-outline-primary btn-sm" id="validateButton">규정 검증</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="exportToPDF()">PDF 저장</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="window.close()">닫기</button>
    </div>
</div>

<div class="preview-container">
    <!-- 왼쪽 설정 패널 -->
    <div class="settings-panel">
        <button class="btn btn-outline-secondary btn-sm w-100 mb-3" onclick="resetSettings()">
            <i class="bi bi-arrow-counterclockwise"></i> 설정 초기화
        </button>
        
        <!-- 탭 네비게이션 추가 -->
        <ul class="nav nav-tabs nav-fill mb-3" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#content-tab">표시사항</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nutrition-tab">영양성분</button>
            </li>
        </ul>
        
        <div class="tab-content">
            <!-- 표시사항 탭 -->
            <div class="tab-pane fade show active" id="content-tab">
                <div class="settings-group">
                    <!-- 레이아웃 선택 추가 -->
                    <div class="settings-row mb-3">
                        <div class="settings-item">
                            <label class="form-label">레이아웃</label>
                            <select class="form-select form-select-sm" id="layoutSelect">
                                <option value="vertical" {% if label.prv_layout == "vertical" %}selected{% endif %}>세로형</option>
                                <option value="horizontal" {% if label.prv_layout == "horizontal" %}selected{% endif %}>가로형</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 기존 설정들 -->
                    <div class="area-info text-primary mb-2">
                        정보표시면 면적: <span id="areaDisplay">100</span> cm²
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label required">가로 (cm)</label>
                            <input type="number" class="form-control form-control-sm" id="widthInput" 
                                   value="{{ label.prv_width|default:'10' }}" min="4" max="30" step="1">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item" style="display: flex; align-items: center; gap: 6px;">
                            <label class="form-label required">세로 (cm)</label>
                            <input type="number" class="form-control form-control-sm" id="heightInput" value="{{ label.prv_length|default:'10' }}" min="3" max="20" step="1" style="width: 80px;">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">글꼴</label>
                            <select class="form-select form-select-sm" id="fontFamilySelect">
                                <option value="'Noto Sans KR'" {% if label.prv_font == "'Noto Sans KR'" %}selected{% endif %}>노토 산스</option>
                                <option value="'Nanum Gothic'" {% if label.prv_font == "'Nanum Gothic'" %}selected{% endif %}>나눔고딕</option>
                                <option value="'Nanum Myeongjo'" {% if label.prv_font == "'Nanum Myeongjo'" %}selected{% endif %}>나눔명조</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">글자 크기 (pt)</label>
                            <input type="number" class="form-control form-control-sm" id="fontSizeInput" 
                                   value="{{ label.prv_font_size|default:'10' }}" min="10" max="72" step="1">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">자간 (%)</label>
                            <input type="number" class="form-control form-control-sm" id="letterSpacingInput" 
                                   value="{{ label.prv_letter_spacing|default:'-5' }}" min="-5" max="10" step="1">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">줄간격</label>
                            <input type="number" class="form-control form-control-sm" id="lineHeightInput" 
                                   value="{{ label.prv_line_spacing|default:'1.2' }}" min="1" max="3.0" step="0.1">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 영양성분 탭 -->
            <div class="tab-pane fade" id="nutrition-tab">
                <div class="nutrition-settings">
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">1회 제공량</label>
                            <input type="number" class="form-control form-control-sm" id="servingSizeInput" 
                                   value="100" min="0" max="1000" step="1">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-item">
                            <label class="form-label">단위</label>
                            <select class="form-select form-select-sm" id="servingUnitSelect">
                                <option value="g">g</option>
                                <option value="ml">ml</option>
                                <option value="개">개</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 오른쪽 미리보기 패널 -->
    <div class="preview-panel">
        <div id="previewContent" class="preview-content">
            <div class="preview-header-box">
                <div class="header-text">식품위생법에 따른 한글표시사항</div>
            </div>
            
            <!-- CSRF 토큰을 미리보기 팝업에도 전달 -->
            <form style="display:none;">
              {% csrf_token %}
            </form>
            
            <!-- label_id hidden input 추가 -->
            <input type="hidden" name="label_id" value="{{ label.my_label_id }}">
            
            <table class="preview-table">
                <tbody>
                    {% for item in preview_items %}
                    <tr>
                        <th>{{ item.label }}</th>
                        <td class="{% if item.label == '제품명' %}product-name{% elif item.label == '원산지' %}origin-text{% endif %}">
                            {{ item.value }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="footer-text">
                본 라벨은 식품위생법 및 농수산물 원산지 표시법을 준수합니다.
                <span id="lastModifiedDate" class="text-muted" style="float: right; font-size: 0.9em;"></span>
            </div>
        </div>
    </div>
</div>

<!-- 스타일 수정 -->
<style>
/* 미리보기 헤더박스 스타일 수정 */
.preview-header-box {
    background-color: var(--primary-color) !important;
    color: #ffffff !important;
    padding: 8px 12px;
    margin-bottom: 0;
    width: 100%;
    position: relative;
    z-index: 1;
}

.preview-header-box .header-text {
    margin: 0;
    line-height: 1.2;
    color: #ffffff !important;
    opacity: 1 !important;
    font-weight: bold !important;
}

/* 미리보기 컨텐츠 영역 수정 */
.preview-content {
    border: 1px solid #dee2e6;
    padding: 20px;
    min-height: 400px;
    height: auto;
    width: auto;
    background-color: #ffffff;
    position: relative;
    overflow: visible;
}

/* 푸터 여백 추가 */
.footer-text {
    margin: 20px 0 !important;
    padding-bottom: 10px;
}
</style>

</body>
</html>