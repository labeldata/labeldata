{% extends 'base.html' %}
{% load static %}

{% block title %}ÌëúÏãúÏÇ¨Ìï≠ ÏûëÏÑ±{% endblock %}

{% block content %}
<!-- jQuery & Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Ïô∏Î∂Ä CSS Î∞è JS ÌååÏùº Î°úÎìú -->
<link href="{% static 'css/label_creation.css' %}?v={{ STATIC_BUILD_DATE }}" rel="stylesheet" />
<!-- ÏûêÏ£º ÏÇ¨Ïö©ÌïòÎäî Î¨∏Íµ¨ Îç∞Ïù¥ÌÑ∞ ÏÇΩÏûÖ -->
<script id="phrases-data" type="application/json">
  {{ phrases_json|safe }}
</script>
<script id="regulations-data" type="application/json">
    {{ regulations_json|safe }}
</script>
<script src="{% static 'js/label/label_creation.js' %}?v={{ STATIC_BUILD_DATE }}"></script>


<!-- ÎùºÎ≤® IDÎ•º JavaScriptÏóê Ï†ÑÎã¨ÌïòÍ∏∞ ÏúÑÌïú Ïà®Í≤®ÏßÑ ÏûÖÎ†• ÌïÑÎìú -->
<input type="hidden" id="label_id" value="{{ label.my_label_id }}">

<!-- ÏÉÅÎã® Ìó§Îçî -->
<div class="container mt-4" style="padding-bottom: 10px;">
  <div class="d-flex align-items-center justify-content-between" style="gap: 20px;">
    <h2 class="mb-0">ÌëúÏãúÏÇ¨Ìï≠ ÏûëÏÑ±</h2>
    <div class="d-flex align-items-center" style="gap: 10px;">
      <span class="recent-update">ÏµúÍ∑º ÏàòÏ†ïÏùº: {{ label.update_datetime|date:"Y-m-d H:i" }}</span>
      <button type="submit" form="labelForm" class="btn btn-primary">Ï†ÄÏû•</button>
      <button type="button" class="btn btn-outline-primary" onclick="openPreviewPopup()">ÎØ∏Î¶¨Î≥¥Í∏∞</button>
    </div>
  </div>
</div>

<!-- Step1. Í∏∞Î≥∏ ÏÑ§Ï†ï (ÏöîÏïΩ + Ï†ÅÏö©/ÌéºÏπòÍ∏∞ Î≤ÑÌäº Ìïú Ï§Ñ) -->
<div class="container mt-4" id="step1-row">
  <div class="card">
    <!-- Step1 Ìó§Îçî: Ï¢åÏ∏°(ÌÉÄÏù¥ÌãÄ), Ï§ëÏïô(ÏöîÏïΩ), Ïö∞Ï∏°(Î≤ÑÌäº) -->
    <div class="card-header d-flex align-items-center" id="step1-summary-bar" style="gap: 1rem; flex-wrap:nowrap;">
      <strong>Step1. Í∏∞Î≥∏Ï†ïÎ≥¥ ÏÑ§Ï†ï</strong>
      <!-- summaryÍ∞Ä ÌïúÏ§ÑÎ°ú Ïù¥Ïñ¥ÏßÄÎèÑÎ°ù flex-grow, min-width, overflow Ïä§ÌÉÄÏùº Í∞ïÌôî -->
      <span id="summary-step1"
            class="ms-2"
            style="font-weight:bold; font-size:1rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1 1 0; min-width:0; margin-left:10px; display:block; max-width:100vw;">
      </span>
      <div class="ms-auto d-flex align-items-center" style="gap: 0.5rem;">
        <button type="button" class="btn btn-primary btn-sm" id="applyStep1Btn">Ï†ÅÏö© ÌõÑ Ï†ëÍ∏∞</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="expandStep1Btn" style="display:none;">ÌéºÏπòÍ∏∞</button>
      </div>
    </div>
    <!-- Step1 Î≥∏Î¨∏: ÏãùÌíàÏú†Ìòï/Ïû•Í∏∞Î≥¥Ï°¥/Ï†úÏ°∞Î∞©Î≤ï -->
    <div class="card-body" id="step1-body">
      <div id="food-type-section" class="mb-2">
        <!-- 2Ïó¥ Î†àÏù¥ÏïÑÏõÉ: ÏôºÏ™Ω(ÏãùÌíàÏú†Ìòï/Ïû•Í∏∞Î≥¥Ï°¥), Ïò§Î•∏Ï™Ω(Ï†úÏ°∞Î∞©Î≤ï/Ï°∞Í±¥) -->
        <div class="row" style="gap:0;">
          <!-- ÏôºÏ™Ω: ÏãùÌíàÏú†Ìòï, Ïû•Í∏∞Î≥¥Ï°¥ÏãùÌíà -->
          <div class="col-md-6" style="padding-right:16px;">
            <!-- ÏãùÌíàÏú†Ìòï ÌïúÏ§Ñ -->
            <div class="d-flex align-items-center mb-2 flex-nowrap">
              <label class="form-label mb-0" style="font-size:0.9rem; font-weight:bold; min-width:90px;">ÏãùÌíàÏú†Ìòï</label>
              <div class="d-flex flex-nowrap" style="gap:5px; width:100%; min-width:0;">
                <select id="food_group" name="food_group" class="form-control" style="width:20%; min-width:0;">
                  <option value="">ÎåÄÎ∂ÑÎ•ò</option>
                  {% for group in food_groups %}
                  <option value="{{ group }}" {% if label.food_group == group %}selected{% endif %}>{{ group }}</option>
                  {% endfor %}
                </select>
                <select id="food_type" name="food_type" class="form-control" style="width:20%; min-width:0;">
                  <option value="">ÏÜåÎ∂ÑÎ•ò</option>
                  {% for type in food_types %}
                  <option value="{{ type.food_type }}" 
                          data-group="{{ type.food_group }}"
                          {% if label.food_type == type.food_type %}selected{% endif %}>
                    {{ type.food_type }}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <!-- Ïû•Í∏∞Î≥¥Ï°¥ÏãùÌíà ÌïúÏ§Ñ -->
            <div class="d-flex align-items-center mb-2 flex-nowrap">
              <label class="form-label mb-0" style="font-size:0.9rem; font-weight:bold; min-width:90px;">Ïû•Í∏∞Î≥¥Ï°¥ÏãùÌíà</label>
              <div class="d-flex flex-wrap align-items-center" style="gap:10px;">
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_frozen_heated" name="preservation_type" value="frozen_heated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_heated" %}checked{% endif %}>
                  <label for="chk_frozen_heated" class="form-check-label" style="font-size:0.8rem;">ÎÉâÎèô(Í∞ÄÏó¥)</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_frozen_nonheated" name="preservation_type" value="frozen_nonheated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_nonheated" %}checked{% endif %}>
                  <label for="chk_frozen_nonheated" class="form-check-label" style="font-size:0.8rem;">ÎÉâÎèô(ÎπÑÍ∞ÄÏó¥)</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_canned" name="preservation_type" value="canned" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "canned" %}checked{% endif %}>
                  <label for="chk_canned" class="form-check-label" style="font-size:0.8rem;">ÌÜµ.Î≥ëÏ°∞Î¶º</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_retort" name="preservation_type" value="retort" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "retort" %}checked{% endif %}>
                  <label for="chk_retort" class="form-check-label" style="font-size:0.8rem;">Î†àÌÜ†Î•¥Ìä∏</label>
                </div>
              </div>
            </div>
          </div>
          <!-- Ïò§Î•∏Ï™Ω: Ï†úÏ°∞Î∞©Î≤ï, Ï°∞Í±¥ -->
          <div class="col-md-6" style="padding-left:16px;">
            <!-- Ï†úÏ°∞Î∞©Î≤ï Ï≤¥ÌÅ¨Î∞ïÏä§ ÌïúÏ§Ñ -->
            <div class="d-flex align-items-center mb-2 flex-nowrap">
              <label class="form-label mb-0" style="font-size:0.9rem; font-weight:bold; min-width:90px;">Ï†úÏ°∞Î∞©Î≤ï</label>
              <div class="d-flex flex-nowrap align-items-center" style="gap:10px; width:100%; min-width:0;">
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_sanitized" name="processing_method" value="sanitized" class="form-check-input grp-sterilization" {% if form.processing_method.value == "sanitized" %}checked{% endif %}>
                  <label for="chk_sanitized" class="form-check-label" style="font-size:0.8rem;">ÏÇ¥Í∑†</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_aseptic" name="processing_method" value="aseptic" class="form-check-input grp-sterilization" {% if form.processing_method.value == "aseptic" %}checked{% endif %}>
                  <label for="chk_aseptic" class="form-check-label" style="font-size:0.8rem;">Î©∏Í∑†</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_yutang" name="processing_method" value="yutang" class="form-check-input grp-sterilization" {% if form.processing_method.value == "yutang" %}checked{% endif %}>
                  <label for="chk_yutang" class="form-check-label" style="font-size:0.8rem;">Ïú†ÌÉï/Ïú†Ï≤òÎ¶¨</label>
                </div>
                <div class="form-check" style="margin:0;">
                  <input type="checkbox" id="chk_sterilization_other" name="chk_sterilization_other" class="form-check-input" {% if form.processing_condition.value %}checked{% endif %}>
                  <label for="chk_sterilization_other" class="form-check-label" style="font-size:0.8rem;">Ï°∞Í±¥</label>
                </div>
              </div>
            </div>
            <!-- Ï°∞Í±¥ ÏÉÅÏÑ∏ ÏûÖÎ†• ÌïúÏ§Ñ -->
            <div class="d-flex align-items-center mb-2 flex-nowrap">
              <label class="form-label mb-0" style="font-size:0.9rem; font-weight:bold; min-width:90px; visibility:hidden;">Ï°∞Í±¥ÏÉÅÏÑ∏</label>
              <input type="text" name="processing_condition" class="form-control"
                placeholder="Ï°∞Í±¥ ÏÉÅÏÑ∏"
                style="width:320px; min-width:180px; max-width:100%; flex-shrink:1; white-space:nowrap; overflow:hidden;"
                value="{{ form.processing_condition.value|default:'' }}">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Step2. ÏÉÅÏÑ∏ ÏûÖÎ†• ÏòÅÏó≠ -->
<div class="container mt-4" id="step2-card">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Step2. ÏÉÅÏÑ∏ ÏûÖÎ†•</strong>
      <div class="d-flex align-items-center" style="gap: 8px;">
        <button type="button" class="btn btn-outline-secondary btn-sm ms-2" id="linkedLabelsBtn">
                Ïó∞Í≤∞Îêú ÏõêÎ£å(00ÌíàÎ™©) Ï°∞Ìöå
        </button>
        <button type="button" class="btn btn-outline-primary btn-sm" onclick="openPhrasePopup()" title="ÎÇ¥ Î¨∏Íµ¨ Í¥ÄÎ¶¨">
          ÎÇ¥ Î¨∏Íµ¨ Í¥ÄÎ¶¨
        </button>
      </div>
    </div>
    <div class="card-body">
      <!-- Î≥∏Î¨∏ Ï¢åÏö∞ Ìå®ÎÑê ÏòÅÏó≠ -->
      <div class="layout-container" style="display: flex; gap: 20px; align-items: flex-start;">
        <!-- Ï¢åÏ∏°: ÏûÖÎ†• Ìå®ÎÑê -->
        <div class="left-panel flex-grow-1 position-relative" style="flex-basis: 70%;">
          <form method="post" id="labelForm">
            {% csrf_token %}
            
            <!-- ÏãùÌíàÏú†Ìòï hidden ÌïÑÎìú Ï∂îÍ∞Ä -->
            <input type="hidden" id="hidden_food_group" name="food_group" value="{{ label.food_group }}">
            <input type="hidden" id="hidden_food_type" name="food_type" value="{{ label.food_type }}">
            
            <!-- Ïû•Í∏∞Î≥¥Ï°¥ÏãùÌíà, Ï†úÏ°∞Î∞©Î≤ï hidden ÌïÑÎìú Ï∂îÍ∞Ä -->
            <input type="hidden" id="hidden_preservation_type" name="preservation_type" value="{{ label.preservation_type }}">
            <input type="hidden" id="hidden_processing_method" name="processing_method" value="{{ label.processing_method }}">
            <input type="hidden" id="hidden_processing_condition" name="processing_condition" value="{{ label.processing_condition }}">
            
            <!-- Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú Ï†ÄÏû•Ïö© hidden ÌïÑÎìú -->
            <input type="hidden" name="chckd_label_nm" value="{{ label.chckd_label_nm|default:'N' }}">
            <input type="hidden" name="chckd_prdlst_dcnm" value="{{ label.chckd_prdlst_dcnm|default:'N' }}">
            <input type="hidden" name="chckd_prdlst_nm" value="{{ label.chckd_prdlst_nm|default:'Y' }}">
            <input type="hidden" name="chckd_ingredient_info" value="{{ label.chckd_ingredient_info|default:'N' }}">
            <input type="hidden" name="chckd_content_weight" value="{{ label.chckd_content_weight|default:'Y' }}">
            <input type="hidden" name="chckd_weight_calorie" value="{{ label.chckd_weight_calorie|default:'N' }}">
            <input type="hidden" name="chckd_prdlst_report_no" value="{{ label.chckd_prdlst_report_no|default:'N' }}">
            <input type="hidden" name="chckd_country_of_origin" value="{{ label.chckd_country_of_origin|default:'N' }}">
            <input type="hidden" name="chckd_storage_method" value="{{ label.chckd_storage_method|default:'N' }}">
            <input type="hidden" name="chckd_frmlc_mtrqlt" value="{{ label.chckd_frmlc_mtrqlt|default:'N' }}">
            <input type="hidden" name="chckd_bssh_nm" value="{{ label.chckd_bssh_nm|default:'Y' }}">
            <input type="hidden" name="chckd_distributor_address" value="{{ label.chckd_distributor_address|default:'N' }}">
            <input type="hidden" name="chckd_repacker_address" value="{{ label.chckd_repacker_address|default:'N' }}">
            <input type="hidden" name="chckd_importer_address" value="{{ label.chckd_importer_address|default:'N' }}">
            <input type="hidden" name="chckd_pog_daycnt" value="{{ label.chckd_pog_daycnt|default:'Y' }}">
            <input type="hidden" name="chckd_rawmtrl_nm_display" value="{{ label.chckd_rawmtrl_nm_display|default:'N' }}">
            <input type="hidden" name="chckd_cautions" value="{{ label.chckd_cautions|default:'N' }}">
            <input type="hidden" name="chckd_additional_info" value="{{ label.chckd_additional_info|default:'N' }}">
            <input type="hidden" name="chckd_nutrition_text" value="{{ label.chckd_nutrition_text|default:'N' }}">

          <!-- ÎùºÎ≤®Î™Ö + ÏãùÌíàÏú†Ìòï Ìïú Ï§Ñ Íµ¨ÏÑ± -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <!-- ÎùºÎ≤®Î™Ö -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <!-- ÎùºÎ≤®Î™Ö Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_label_nm" name="chk_label_nm" class="form-check-input" 
                       {% if label.chckd_label_nm == "Y" %}checked{% endif %}>
                <label for="chk_label_nm" class="m-0">ÎùºÎ≤®Î™Ö</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <input type="text" name="my_label_name" class="form-control auto-expand" placeholder="ÎùºÎ≤®Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.my_label_name.value|default:'' }}">
              </div>
            </div>
            <!-- ÏãùÌíàÏú†Ìòï -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_prdlst_dcnm" name="chk_prdlst_dcnm" class="form-check-input" {% if label.chckd_prdlst_dcnm == "Y" %}checked{% endif %}>
                <label for="chk_prdlst_dcnm" class="m-0">ÏãùÌíàÏú†Ìòï</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <input type="text" name="prdlst_dcnm" class="form-control auto-expand" placeholder="ÏÉÅÎã®Ïùò ÏãùÌíàÏú†ÌòïÏùÑ Ï∞∏Í≥†ÌïòÏó¨ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.prdlst_dcnm.value|default:'' }}">
              </div>
            </div>
          </div>

          <!-- Ï†úÌíàÎ™Ö, ÏÑ±Î∂ÑÎ™Ö Î∞è Ìï®Îüâ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <!-- Ï†úÌíàÎ™Ö -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <!-- Ï†úÌíàÎ™Ö Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_prdlst_nm" name="chk_prdlst_nm" class="form-check-input" 
                       {% if label.chckd_prdlst_nm == "Y" %}checked{% endif %}>
                <label for="chk_prdlst_nm" class="m-0">Ï†úÌíàÎ™Ö</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <input type="text" name="prdlst_nm" class="form-control auto-expand" placeholder="Ï†úÌíàÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.prdlst_nm.value|default:'' }}">
              </div>
            </div>
            <!-- ÏÑ±Î∂ÑÎ™Ö Î∞è Ìï®Îüâ -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <!-- ÏÑ±Î∂ÑÎ™Ö Î∞è Ìï®Îüâ Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_ingredient_info" name="chk_ingredient_info" class="form-check-input" 
                       {% if label.chckd_ingredient_info == "Y" %}checked{% endif %}>
                <label for="chk_ingredient_info" class="m-0">ÏÑ±Î∂ÑÎ™Ö Î∞è Ìï®Îüâ</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <input type="text" name="ingredient_info" class="form-control auto-expand" placeholder="Ï†úÌíàÎ™ÖÏóê ÏõêÏû¨Î£åÎ™ÖÏùÑ ÏÇ¨Ïö©Ìïú Í≤ΩÏö∞ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.ingredient_info.value|default:'' }}">
              </div>
            </div>
          </div>

          <!-- ÎÇ¥Ïö©Îüâ, ÎÇ¥Ïö©Îüâ(Ïó¥Îüâ) -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <!-- ÎÇ¥Ïö©Îüâ -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <!-- ÎÇ¥Ïö©Îüâ Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_content_weight" name="chk_content_weight" class="form-check-input" 
                       {% if label.chckd_content_weight == "Y" %}checked{% endif %}>
                <label for="chk_content_weight" class="m-0">ÎÇ¥Ïö©Îüâ</label>
              </div>
              <div style="width:5%;"></div> <!-- Î≤ÑÌäº ÏòÅÏó≠ (ÎπÑÏñ¥ ÏûàÏùå) -->
              <div style="width:85%;">
                <input type="text" name="content_weight" class="form-control auto-expand" placeholder="ÎÇ¥Ïö©ÎüâÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.content_weight.value|default:'' }}">
              </div>
            </div>
            <!-- ÎÇ¥Ïö©Îüâ(Ïó¥Îüâ) -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_weight_calorie" name="chk_weight_calorie" class="form-check-input" {% if label.chckd_weight_calorie == "Y" %}checked{% endif %}>
                <label for="chk_weight_calorie" class="m-0">ÎÇ¥Ïö©Îüâ(Ïó¥Îüâ)</label>
              </div>
              <div style="width:5%;"></div> <!-- Î≤ÑÌäº ÏòÅÏó≠ (ÎπÑÏñ¥ ÏûàÏùå) -->
              <div style="width:85%;">
                <input type="text" name="weight_calorie" class="form-control auto-expand" placeholder="ÎÇ¥Ïö©Îüâ(Ïó¥Îüâ) ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value="{{ form.weight_calorie.value|default:'' }}">
              </div>
            </div>
          </div>

          <!-- ÌíàÎ™©Î≥¥Í≥†Î≤àÌò∏, ÏõêÏÇ∞ÏßÄ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <!-- ÌíàÎ™©Î≥¥Í≥†Î≤àÌò∏ -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_prdlst_report_no" name="chk_prdlst_report_no" class="form-check-input" {% if label.chckd_prdlst_report_no == "Y" %}checked{% endif %}>
                <label for="chk_prdlst_report_no" class="m-0">ÌíàÎ™©Î≥¥Í≥†Î≤àÌò∏</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <div class="d-flex align-items-center" style="gap:6px;">
                  <input type="text" name="prdlst_report_no" class="form-control" value="{{ form.prdlst_report_no.value|default:'' }}" style="width:calc(100% - 90px); min-width:0;">
                  <button type="button" class="btn btn-outline-primary btn-sm" id="verifyReportNoBtn" style="width:80px;">Î≤àÌò∏Í≤ÄÏ¶ù</button>
                </div>
              </div>
            </div>
            <!-- ÏõêÏÇ∞ÏßÄ -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_country_of_origin" name="chk_country_of_origin" class="form-check-input" {% if label.chckd_country_of_origin == "Y" %}checked{% endif %}>
                <label for="chk_country_of_origin" class="m-0">ÏõêÏÇ∞ÏßÄ</label>
              </div>
              <div style="width:5%;"></div>
              <div style="width:85%;">
                <div class="d-flex align-items-center" style="gap:6px;">
                  <select name="country_of_origin" class="form-control select2-country" style="width:100%; min-width:0;">
                    <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    {% for c in country_list %}
                    <option value="{{ c.country_code2 }}" {% if form.country_of_origin.value == c.country_code2 %}selected{% endif %}>{{ c.country_name_ko }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Î≥¥Í¥ÄÎ∞©Î≤ï, Ïö©Í∏∞.Ìè¨Ïû•Ïû¨Ïßà -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <!-- Î≥¥Í¥ÄÎ∞©Î≤ï -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_storage_method" name="chk_storage_method" class="form-check-input" {% if label.chckd_storage_method == "Y" %}checked{% endif %}>
                <label for="chk_storage_method" class="m-0">Î≥¥Í¥ÄÎ∞©Î≤ï</label>
              </div>
              <div style="width:5%;"></div> <!-- Î≤ÑÌäº ÏòÅÏó≠ (ÎπÑÏñ¥ ÏûàÏùå) -->
              <div style="width:85%;">
                <input type="text" name="storage_method" class="form-control auto-expand" placeholder="Î≥¥Í¥ÄÎ∞©Î≤ïÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî." value="{{ form.storage_method.value|default:'' }}">
              </div>
            </div>
            <!-- Ïö©Í∏∞.Ìè¨Ïû•Ïû¨Ïßà -->
            <div class="d-flex align-items-center" style="flex:1; gap:5px;">
              <div style="width:10%; min-width:110px;">
                <input type="checkbox" id="chk_frmlc_mtrqlt" name="chk_frmlc_mtrqlt" class="form-check-input" {% if label.chckd_frmlc_mtrqlt == "Y" %}checked{% endif %}>
                <label for="chk_frmlc_mtrqlt" class="m-0">Ïö©Í∏∞.Ìè¨Ïû•Ïû¨Ïßà</label>
              </div>
              <div style="width:5%;"></div> <!-- Î≤ÑÌäº ÏòÅÏó≠ (ÎπÑÏñ¥ ÏûàÏùå) -->
              <div style="width:85%;">
                <input type="text" name="frmlc_mtrqlt" class="form-control auto-expand" placeholder="Ïö©Í∏∞.Ìè¨Ïû•Ïû¨ÏßàÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."value="{{ form.frmlc_mtrqlt.value|default:'' }}">
              </div>
            </div>
          </div>

          <!-- Ï†úÏ°∞Ïõê ÏÜåÏû¨ÏßÄ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:9.6%; min-width:110px;">
              <!-- Ï†úÏ°∞Ïõê ÏÜåÏû¨ÏßÄ Ï≤¥ÌÅ¨Î∞ïÏä§ -->
              <input type="checkbox" id="chk_bssh_nm" name="chk_bssh_nm" class="form-check-input" 
                     {% if label.chckd_bssh_nm == "Y" %}checked{% endif %}>
              <label for="chk_bssh_nm" class="m-0">Ï†úÏ°∞Ïõê ÏÜåÏû¨ÏßÄ</label>
            </div>
            <div style="min-width:1px;">
              <!-- Ï†úÏ°∞Ïõê ÏÜåÏû¨ÏßÄ Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞ Î≤ÑÌäº -->
              <button type="button" class="btn btn-icon" id="toggleManufacturerBtn"
                data-bs-toggle="collapse" data-bs-target="#other-manufacturers" aria-expanded="false"
                aria-controls="other-manufacturers" style="font-size: 1rem; padding: 2px 1px;" title="ÌéºÏπòÍ∏∞">‚à®</button>
            </div>
            <div style="width:90.4%;">
              <input type="text" name="bssh_nm" class="form-control auto-expand"  placeholder="Ï†úÏ°∞ÏõêÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."value="{{ form.bssh_nm.value|default:'' }}">
            </div>
          </div>

          <!-- Ï†ëÌûò ÏòÅÏó≠ (Ìï≠Î™©Îì§ Ìïú Ï§Ñ Ï†ïÎ†¨) -->
          <div class="collapse mb-2" id="other-manufacturers">
            <!-- Ïú†ÌÜµÏ†ÑÎ¨∏ÌåêÎß§Ïõê -->
            <div class="d-flex align-items-center mb-2" style="gap:5px;">
              <div style="width:11.1%; min-width:130px;">
                <!-- Ïú†ÌÜµÏ†ÑÎ¨∏ ÌåêÎß§Ïõê Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_distributor_address" name="chk_distributor_address" class="form-check-input" 
                       {% if label.chckd_distributor_address == "Y" %}checked{% endif %}>
                <label for="chk_distributor_address" class="m-0">Ïú†ÌÜµÏ†ÑÎ¨∏ÌåêÎß§Ïõê</label>
              </div>
              <div style="width:88.9%;">
                <input type="text" name="distributor_address" class="form-control auto-expand" placeholder="Ïú†ÌÜµÏ†ÑÎ¨∏ÌåêÎß§ÏõêÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."
                      value="{{ form.distributor_address.value|default:'' }}">
              </div>
            </div>

            <!-- ÏÜåÎ∂ÑÏõê -->
            <div class="d-flex align-items-center mb-2" style="gap:5px;">
              <div style="width:11.1%; min-width:130px;">
                <!-- ÏÜåÎ∂ÑÏõê Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_repacker_address" name="chk_repacker_address" class="form-check-input" 
                       {% if label.chckd_repacker_address == "Y" %}checked{% endif %}>
                <label for="chk_repacker_address" class="m-0">ÏÜåÎ∂ÑÏõê</label>
              </div>
              <div style="width:88.9%;">
                <input type="text" name="repacker_address" class="form-control auto-expand" placeholder="ÏÜåÎ∂ÑÏõêÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."
                      value="{{ form.repacker_address.value|default:'' }}">
              </div>
            </div>

            <!-- ÏàòÏûÖÏõê -->
            <div class="d-flex align-items-center mb-2" style="gap:5px;">
              <div style="width:11.1%; min-width:130px;">
                <!-- ÏàòÏûÖÏõê Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                <input type="checkbox" id="chk_importer_address" name="chk_importer_address" class="form-check-input" 
                       {% if label.chckd_importer_address == "Y" %}checked{% endif %}>
                <label for="chk_importer_address" class="m-0">ÏàòÏûÖÏõê</label>
              </div>
              <div style="width:88.9%;">
                <input type="text" name="importer_address" class="form-control auto-expand" placeholder="ÏàòÏûÖÏõêÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."
                      value="{{ form.importer_address.value|default:'' }}">
              </div>
            </div>
          </div>
          
          <!-- ÏÜåÎπÑÍ∏∞Ìïú/ÌíàÏßàÏú†ÏßÄÍ∏∞Ìïú/Ï†úÏ°∞Ïó∞ÏõîÏùº/ÏÉùÏÇ∞Ïó∞ÎèÑ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:11.6%; min-width:130px;">
              <input type="checkbox" id="chk_pog_daycnt" name="chk_pog_daycnt" class="form-check-input" {% if label.chckd_pog_daycnt == "Y" %}checked{% endif %}>
              <label for="chk_pog_daycnt" class="m-0">ÏÜåÎπÑÍ∏∞Ìïú</label>
            </div>
            
            <div style="width:88.4%;">
              <div class="d-flex" style="gap:5px;">
            <select name="date_option" class="form-control select2-date-option" style="width:50%;">
              <option value="ÏÜåÎπÑÍ∏∞Ìïú" {% if form.date_option.value == "ÏÜåÎπÑÍ∏∞Ìïú" or not form.date_option.value %}selected{% endif %}>ÏÜåÎπÑÍ∏∞Ìïú</option>
              <option value="ÌíàÏßàÏú†ÏßÄÍ∏∞Ìïú" {% if form.date_option.value == "ÌíàÏßàÏú†ÏßÄÍ∏∞Ìïú" %}selected{% endif %}>ÌíàÏßàÏú†ÏßÄÍ∏∞Ìïú</option>
              <option value="Ï†úÏ°∞Ïó∞ÏõîÏùº" {% if form.date_option.value == "Ï†úÏ°∞Ïó∞ÏõîÏùº" %}selected{% endif %}>Ï†úÏ°∞Ïó∞ÏõîÏùº</option>
              <option value="ÏÉùÏÇ∞Ïó∞ÎèÑ" {% if form.date_option.value == "ÏÉùÏÇ∞Ïó∞ÎèÑ" %}selected{% endif %}>ÏÉùÏÇ∞Ïó∞ÎèÑ</option>
            </select>
            <input type="text" name="pog_daycnt" class="form-control auto-expand" placeholder="ÏÜåÎπÑÍ∏∞Ìïú Îì±ÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî." value="{{ form.pog_daycnt.value|default:'' }}">
              </div>
            </div>
          </div>
          
          <!-- ÏõêÏû¨Î£åÎ™Ö(ÌëúÏãú) -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:9.6%; min-width:110px;">
              <input type="checkbox" id="chk_rawmtrl_nm_display" name="chk_rawmtrl_nm_display" class="form-check-input" {% if label.chckd_rawmtrl_nm_display == "Y" %}checked{% endif %}>
              <label for="chk_rawmtrl_nm_display" class="m-0">ÏõêÏû¨Î£åÎ™Ö(ÌëúÏãú)</label>
            </div>
            <div style="min-width:1px;">
              <!-- ÏõêÏû¨Î£åÎ™Ö(ÌëúÏãú) ÏÉÅÏÑ∏ÏûÖÎ†• Î≤ÑÌäº -->
              <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;" onclick="handleIngredientPopup()" title="ÏÉÅÏÑ∏ÏûÖÎ†•">‚úö</button>
            </div>
            <div style="width:90.4%;">
              <textarea name="rawmtrl_nm_display" class="form-control auto-expand" rows="2" placeholder="ÏõêÏû¨Î£åÎ™Ö(ÌëúÏãú)ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"> {{ form.rawmtrl_nm_display.value|default:form.rawmtrl_nm.value|default:'' }}</textarea>
            </div>
          </div>

          <!-- ÏõêÏû¨Î£åÎ™Ö (Ï∞∏Í≥†) - ingredient_relationsÍ∞Ä ÏûàÏùÑ ÎïåÎßå ÌëúÏãú -->
          {% if has_ingredient_relations %}
          <div class="mb-2" id="rawmtrl_nm_section">
            <div class="d-flex align-items-center" style="gap:5px;">
              <div style="width:11%; min-width:130px;">
                <div class="form-check">
                  <input type="checkbox" id="chk_rawmtrl_nm" name="chk_rawmtrl_nm" class="form-check-input" 
                         {% if label.chckd_rawmtrl_nm == "Y" %}checked{% endif %} disabled>
                  <label for="chk_rawmtrl_nm" class="m-0">ÏõêÏû¨Î£åÎ™Ö(Ï∞∏Í≥†)</label>
                </div>
              </div>
              <div style="width:89%;">
                <textarea name="rawmtrl_nm" class="form-control auto-expand disabled-textarea" style="flex:1;" 
                          placeholder="ÏõêÏû¨Î£åÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" disabled readonly>{{ form.rawmtrl_nm.value|default:'' }}</textarea>
              </div>
            </div>  
          </div>
          {% endif %}

          <!-- Ï£ºÏùòÏÇ¨Ìï≠ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:11%; min-width:130px;">
              <div class="form-check">
              <input type="checkbox" id="chk_cautions" name="chk_cautions" class="form-check-input" {% if label.chckd_cautions == "Y" %}checked{% endif %}>
              <label for="chk_cautions" class="m-0">Ï£ºÏùòÏÇ¨Ìï≠</label>
              </div>
            </div>
            <div style="width:89%;">
              <textarea name="cautions" 
                class="form-control auto-expand" 
                placeholder="Ï£ºÏùòÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Ïó¨Îü¨ Ìï≠Î™©ÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.">{{ form.cautions.value|default:'' }}</textarea>
            </div>
          </div>
          <!-- Í∏∞ÌÉÄ ÌëúÏãúÏÇ¨Ìï≠ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:11%; min-width:130px;">
              <div class="form-check">
              <input type="checkbox" id="chk_additional_info" name="chk_additional_info" class="form-check-input" {% if label.chckd_additional_info == "Y" %}checked{% endif %}>
              <label for="chk_additional_info" class="m-0">Í∏∞ÌÉÄÌëúÏãúÏÇ¨Ìï≠</label>
              </div>
            </div>
            <div style="width:89%;">
              <textarea name="additional_info" 
                class="form-control auto-expand" 
                placeholder="Í∏∞ÌÉÄ ÌëúÏãúÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÎÇ¥Î¨∏Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Ïó¨Îü¨ Ìï≠Î™©ÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.">{{ form.additional_info.value|default:'' }}</textarea>
              </div>
          </div>    

          <!-- ÏòÅÏñëÏÑ±Î∂Ñ -->
          <div class="d-flex align-items-center mb-2" style="gap:5px;">
            <div style="width:9%; min-width:105px;">
              <div class="form-check">
                <input type="checkbox" id="chk_nutrition_text" name="chk_nutrition_text" class="form-check-input" {% if label.chckd_nutrition_text == "Y" %}checked{% endif %}>
                <label for="chk_nutrition_text" class="form-check-label m-0">ÏòÅÏñëÏÑ±Î∂Ñ</label>
              </div>
            </div>
            <div style="min-width:1px;">
              <!-- ÏòÅÏñëÏÑ±Î∂Ñ Í≥ÑÏÇ∞Í∏∞ Î≤ÑÌäº -->
              <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;"
              onclick="openNutritionCalculator()" title="ÏòÅÏñëÏÑ±Î∂Ñ Í≥ÑÏÇ∞Í∏∞">
              üßÆ
              </button>
            </div>
            <div style="width:91%;">
              <textarea id="nutrition_text"
                name="nutrition_text"
                class="form-control auto-expand"
                placeholder="ÏòÅÏñëÏÑ±Î∂Ñ Í≥ÑÏÇ∞Í∏∞Î•º ÌÜµÌï¥ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                readonly>{{ form.nutrition_text.value|default:'' }}</textarea>
            </div>
          </div>

          <!-- ÏòÅÏñëÏÑ±Î∂Ñ hidden ÌïÑÎìú -->
          <div style="display: none;">
            <input type="hidden" name="serving_size" value="{{ form.serving_size.value|default:'' }}">
            <input type="hidden" name="serving_size_unit" value="{{ form.serving_size_unit.value|default:'' }}">
            <input type="hidden" name="units_per_package" value="{{ form.units_per_package.value|default:'' }}">
            <input type="hidden" name="nutrition_display_unit" value="{{ form.nutrition_display_unit.value|default:'' }}">
            <input type="hidden" name="calories" value="{{ form.calories.value|default:'' }}">
            <input type="hidden" name="calories_unit" value="{{ form.calories_unit.value|default:'' }}">
            <input type="hidden" name="natriums" value="{{ form.natriums.value|default:'' }}">
            <input type="hidden" name="natriums_unit" value="{{ form.natriums_unit.value|default:'' }}">
            <input type="hidden" name="carbohydrates" value="{{ form.carbohydrates.value|default:'' }}">
            <input type="hidden" name="carbohydrates_unit" value="{{ form.carbohydrates_unit.value|default:'' }}">
            <input type="hidden" name="sugars" value="{{ form.sugars.value|default:'' }}">
            <input type="hidden" name="sugars_unit" value="{{ form.sugars_unit.value|default:'' }}">
            <input type="hidden" name="fats" value="{{ form.fats.value|default:'' }}">
            <input type="hidden" name="fats_unit" value="{{ form.fats_unit.value|default:'' }}">
            <input type="hidden" name="trans_fats" value="{{ form.trans_fats.value|default:'' }}">
            <input type="hidden" name="trans_fats_unit" value="{{ form.trans_fats_unit.value|default:'' }}">
            <input type="hidden" name="saturated_fats" value="{{ form.saturated_fats.value|default:'' }}">
            <input type="hidden" name="saturated_fats_unit" value="{{ form.saturated_fats_unit.value|default:'' }}">
            <input type="hidden" name="cholesterols" value="{{ form.cholesterols.value|default:'' }}">
            <input type="hidden" name="cholesterols_unit" value="{{ form.cholesterols_unit.value|default:'' }}">
            <input type="hidden" name="proteins" value="{{ form.proteins.value|default:'' }}">
            <input type="hidden" name="proteins_unit" value="{{ form.proteins_unit.value|default:'' }}">
          </div>

          </form>
        </div>

        <!-- Ïö∞Ï∏° Ìå®ÎÑê ÌÉ≠ Íµ¨Ï°∞ -->
        <div id="regulationPanel" class="right-panel collapsible-panel show">
          <!-- ÌÉ≠ Î©îÎâ¥ -->
          <ul class="nav nav-tabs" id="phraseTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link active" id="regulation-tab" data-bs-toggle="tab" href="#regulation-content">ÏãùÌíàÏú†ÌòïÎ≥Ñ Í∑úÏ†ï</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="myphrases-tab" data-bs-toggle="tab" href="#myphrases-content">Ìï≠Î™©Î≥Ñ Î¨∏Íµ¨ Î∞è Í∑úÏ†ï</a>
            </li>
          </ul>

          <!-- ÌÉ≠ ÎÇ¥Ïö© -->
          <div class="tab-content p-2" style="height:100%;">
            <!-- Í¥ÄÎ†®Í∑úÏ†ï -->
            <div class="tab-pane fade show active" id="regulation-content" role="tabpanel">
              <textarea name="related_regulations" readonly class="form-control">...</textarea>
            </div>
            <!-- ÎÇ¥Î¨∏Íµ¨ -->
            <div class="tab-pane fade" id="myphrases-content" role="tabpanel">
              <div id="myPhraseContainer" style="max-height:400px; overflow-y:auto;">
                <!-- Í∑úÏ†ï Ï†ïÎ≥¥Îäî JSÎ°ú ÎèôÏ†Å Ï∂îÍ∞Ä -->
                <div id="myPhraseList" class="d-flex flex-column gap-2"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}