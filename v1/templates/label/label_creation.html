{% extends 'base.html' %}
{% load static %}

{% block title %}표시사항 작성{% endblock %}

{% block content %}
<!-- jQuery & Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- 외부 CSS 및 JS 파일 로드 -->
<link href="{% static 'css/label_creation.css' %}" rel="stylesheet" />
<!-- 자주 사용하는 문구 데이터 삽입 -->
<script id="phrases-data" type="application/json">
  {{ phrases_json|safe }}
</script>
<script id="regulations-data" type="application/json">
    {{ regulations_json|safe }}
</script>
<script src="{% static 'js/label/label_creation.js' %}"></script>


<!-- 라벨 ID를 JavaScript에 전달하기 위한 숨겨진 입력 필드 -->
<input type="hidden" id="label_id" value="{{ label.my_label_id }}">

<!-- 상단 헤더 -->
<div class="container mt-4" style="padding-bottom: 10px;">
  <div class="d-flex align-items-center justify-content-between" style="gap: 20px;">
    <h2 class="mb-0">표시사항 작성</h2>
    <div class="d-flex align-items-center" style="gap: 10px;">
      <span class="recent-update">최근 수정일: {{ label.update_datetime|date:"Y-m-d H:i" }}</span>
      <button type="submit" form="labelForm" class="btn btn-primary">저장</button>
      <button type="button" class="btn btn-outline-secondary" onclick="openPreviewPopup()">미리보기</button>
    </div>
  </div>
</div>

<!-- 식품유형/장기보존/제조방법 선택 영역 -->
<div id="food-type-section" class="container mb-2" style="display:block;">
  <div class="d-flex align-items-center" style="gap:20px; width:100%;">
    <!-- 식품유형 드롭다운 수정 -->
    <div class="selectable-item" style="flex:1; max-width:25%;">
      <label class="form-label" style="font-size:0.8rem; font-weight:bold;">식품유형</label>
      <div class="d-flex" style="gap:5px; width:100%;">
        <select id="food_group" name="food_group" class="form-control" style="width:50%;">
          <option value="">대분류</option>
          {% for group in food_groups %}
          <option value="{{ group }}" {% if label.food_group == group %}selected{% endif %}>{{ group }}</option>
          {% endfor %}
        </select>
        <select id="food_type" name="food_type" class="form-control" style="width:50%;">
          <option value="">소분류</option>
          {% for type in food_types %}
          <option value="{{ type.food_type }}" 
                  data-group="{{ type.food_group }}" 
                  {% if label.food_type == type.food_type %}selected{% endif %}>
            {{ type.food_type }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- 장기보존식품 -->
    <div style="flex:1; max-width:30%; display: flex; flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: center; margin-left: 0;">
         <input type="checkbox" id="dummy_long_shelf" style="visibility:hidden; width:18px; margin-right:5px;">
         <label class="form-label" style="font-size:0.8rem; font-weight:bold;">장기보존식품</label>
      </div>
      <div class="d-flex align-items-center" style="gap:10px; width:100%;">
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_frozen_heated" name="preservation_type" value="frozen_heated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_heated" %}checked{% endif %}>
          <label for="chk_frozen_heated" class="form-check-label" style="font-size:0.8rem;">냉동(가열)</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_frozen_nonheated" name="preservation_type" value="frozen_nonheated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_nonheated" %}checked{% endif %}>
          <label for="chk_frozen_nonheated" class="form-check-label" style="font-size:0.8rem;">냉동(비가열)</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_canned" name="preservation_type" value="canned" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "canned" %}checked{% endif %}>
          <label for="chk_canned" class="form-check-label" style="font-size:0.8rem;">통.병조림</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_retort" name="preservation_type" value="retort" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "retort" %}checked{% endif %}>
          <label for="chk_retort" class="form-check-label" style="font-size:0.8rem;">레토르트</label>
        </div>
      </div>
    </div>
    

    <!-- 제조방법 -->
    <div style="flex:1; max-width:40%; display: flex; flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: center; margin-left: 0;">
         <input type="checkbox" id="dummy_manufacturing" style="visibility:hidden; width:18px; margin-right:5px;">
         <label class="form-label" style="font-size:0.8rem; font-weight:bold; ">제조방법</label>
      </div>
      <div class="d-flex align-items-center" style="gap:10px; flex-wrap: nowrap; width:100%;">
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_sanitized" name="processing_method" value="sanitized" class="form-check-input grp-sterilization" {% if form.processing_method.value == "sanitized" %}checked{% endif %}>
          <label for="chk_sanitized" class="form-check-label" style="font-size:0.8rem;">살균</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_aseptic" name="processing_method" value="aseptic" class="form-check-input grp-sterilization" {% if form.processing_method.value == "aseptic" %}checked{% endif %}>
          <label for="chk_aseptic" class="form-check-label" style="font-size:0.8rem;">멸균</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_yutang" name="processing_method" value="yutang" class="form-check-input grp-sterilization" {% if form.processing_method.value == "yutang" %}checked{% endif %}>
          <label for="chk_yutang" class="form-check-label" style="font-size:0.8rem;">유탕/유처리</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_sterilization_other" name="chk_sterilization_other" class="form-check-input" {% if form.processing_condition.value %}checked{% endif %}>
          <label for="chk_sterilization_other" class="form-check-label" style="font-size:0.8rem;">조건</label>
        </div>
        <input type="text" name="processing_condition" class="form-control" placeholder="조건 상세" style="width:120px;" value="{{ form.processing_condition.value|default:'' }}">
      </div>
    </div>
  </div>
</div>

<hr class="mb-2">

<!-- 식품유형 요약 -->
<div class="container mb-2 d-flex justify-content-between align-items-center">
  <div id="selected-info" style="font-weight:bold; font-size:0.9rem;">식품유형 :</div>
  <div class="d-flex align-items-center" style="gap: 5px;">
    <!-- 내 문구 관리 버튼 -->
    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="openPhrasePopup()" title="내 문구 관리">
      내 문구 관리
    </button>
    <!-- 식품유형 접기/펼치기 버튼 -->
    <button id="toggleFoodTypeBtn" class="btn btn-icon" type="button" title="접기" style="font-size: 1rem;">∧</button>
    <!-- 우측 패널 접기/펼치기 버튼 -->
    <button id="toggleRegulationBtn" class="btn btn-icon" title="접기" style="font-size: 1rem;">❯</button>
  </div>
</div>

<!-- 본문 좌우 패널 영역 -->
<div class="container">
  <div class="layout-container" style="display: flex; gap: 20px; align-items: flex-start;">
    <!-- 좌측: 입력 패널 -->
    <div class="left-panel flex-grow-1 position-relative" style="flex-basis: 70%;">
      <form method="post" id="labelForm">
        {% csrf_token %}
        
        <!-- 식품유형 hidden 필드 추가 -->
        <input type="hidden" id="hidden_food_group" name="food_group" value="{{ label.food_group }}">
        <input type="hidden" id="hidden_food_type" name="food_type" value="{{ label.food_type }}">
        
        <!-- 장기보존식품, 제조방법 hidden 필드 추가 -->
        <input type="hidden" id="hidden_preservation_type" name="preservation_type" value="{{ label.preservation_type }}">
        <input type="hidden" id="hidden_processing_method" name="processing_method" value="{{ label.processing_method }}">
        <input type="hidden" id="hidden_processing_condition" name="processing_condition" value="{{ label.processing_condition }}">
        
        <!-- 체크박스 상태 저장용 hidden 필드 -->
        <input type="hidden" name="chckd_label_nm" value="{{ label.chckd_label_nm|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_dcnm" value="{{ label.chckd_prdlst_dcnm|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_nm" value="{{ label.chckd_prdlst_nm|default:'Y' }}">
        <input type="hidden" name="chckd_ingredients_info" value="{{ label.chckd_ingredients_info|default:'N' }}">
        <input type="hidden" name="chckd_content_weight" value="{{ label.chckd_content_weight|default:'Y' }}">
        <input type="hidden" name="chckd_weight_calorie" value="{{ label.chckd_weight_calorie|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_report_no" value="{{ label.chckd_prdlst_report_no|default:'N' }}">
        <input type="hidden" name="chckd_country_of_origin" value="{{ label.chckd_country_of_origin|default:'N' }}">
        <input type="hidden" name="chckd_storage_method" value="{{ label.chckd_storage_method|default:'N' }}">
        <input type="hidden" name="chckd_frmlc_mtrqlt" value="{{ label.chckd_frmlc_mtrqlt|default:'N' }}">
        <input type="hidden" name="chckd_manufacturer_info" value="{{ label.chckd_manufacturer_info|default:'Y' }}">
        <input type="hidden" name="chckd_distributor_address" value="{{ label.chckd_distributor_address|default:'N' }}">
        <input type="hidden" name="chckd_repacker_address" value="{{ label.chckd_repacker_address|default:'N' }}">
        <input type="hidden" name="chckd_importer_address" value="{{ label.chckd_importer_address|default:'N' }}">
        <input type="hidden" name="chckd_date_info" value="{{ label.chckd_date_info|default:'Y' }}">
        <input type="hidden" name="chckd_rawmtrl_nm_display" value="{{ label.chckd_rawmtrl_nm_display|default:'N' }}">
        <input type="hidden" name="chckd_cautions" value="{{ label.chckd_cautions|default:'N' }}">
        <input type="hidden" name="chckd_additional_info" value="{{ label.chckd_additional_info|default:'N' }}">
        <input type="hidden" name="chckd_nutrition_text" value="{{ label.chckd_nutrition_text|default:'N' }}">

      <!-- 라벨명 + 식품유형 한 줄 구성 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- 라벨명 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- 라벨명 체크박스 -->
            <input type="checkbox" id="chk_label_nm" name="chk_label_nm" class="form-check-input" 
                   {% if form.chk_label_nm.value == "Y" %}checked{% endif %}>
            <label for="chk_label_nm" class="m-0">라벨명</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="my_label_name" class="form-control auto-expand" placeholder="라벨명을 입력하세요." value="{{ form.my_label_name.value|default:'' }}">
          </div>
        </div>
        <!-- 식품유형 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_prdlst_dcnm" name="chk_prdlst_dcnm" class="form-check-input" {% if form.chk_prdlst_dcnm.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_dcnm" class="m-0">식품유형</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="prdlst_dcnm" class="form-control auto-expand" placeholder="상단의 식품유형을 참고하여 입력하세요." value="{{ form.prdlst_dcnm.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- 제품명, 성분명 및 함량 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- 제품명 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- 제품명 체크박스 -->
            <input type="checkbox" id="chk_prdlst_nm" name="chk_prdlst_nm" class="form-check-input" 
                   {% if form.chk_prdlst_nm.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_nm" class="m-0">제품명</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="prdlst_nm" class="form-control auto-expand" placeholder="제품명을 입력하세요." value="{{ form.prdlst_nm.value|default:'' }}">
          </div>
        </div>
        <!-- 성분명 및 함량 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- 성분명 및 함량 체크박스 -->
            <input type="checkbox" id="chk_ingredients_info" name="chk_ingredients_info" class="form-check-input" 
                   {% if form.chk_ingredients_info.value == "Y" %}checked{% endif %}>
            <label for="chk_ingredients_info" class="m-0">성분명 및 함량</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="ingredient_info" class="form-control auto-expand" placeholder="제품명에 원재료명을 사용한 경우 입력하세요." value="{{ form.ingredient_info.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- 내용량, 내용량(열량) -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- 내용량 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- 내용량 체크박스 -->
            <input type="checkbox" id="chk_content_weight" name="chk_content_weight" class="form-check-input" 
                   {% if form.chk_content_weight.value == "Y" %}checked{% endif %}>
            <label for="chk_content_weight" class="m-0">내용량</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <input type="text" name="content_weight" class="form-control auto-expand" placeholder="내용량을 입력하세요." value="{{ form.content_weight.value|default:'' }}">
          </div>
        </div>
        <!-- 내용량(열량) -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_weight_calorie" name="chk_weight_calorie" class="form-check-input" {% if form.chk_weight_calorie.value == "Y" %}checked{% endif %}>
            <label for="chk_weight_calorie" class="m-0">내용량(열량)</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <input type="text" name="weight_calorie" class="form-control auto-expand" placeholder="내용량(열량) 형식으로 입력하세요." value="{{ form.weight_calorie.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- 품목보고번호, 원산지 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- 품목보고번호 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_prdlst_report_no" name="chk_prdlst_report_no" class="form-check-input" {% if form.chk_prdlst_report_no.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_report_no" class="m-0">품목보고번호</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <input type="text" name="prdlst_report_no" class="form-control" value="{{ form.prdlst_report_no.value|default:'' }}">
          </div>
        </div>
        <!-- 원산지 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_country_of_origin" name="chk_country_of_origin" class="form-check-input" {% if form.chk_country_of_origin.value == "Y" %}checked{% endif %}>
            <label for="chk_country_of_origin" class="m-0">원산지</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <select name="country_of_origin" class="form-control select2-country">
              <option value="">선택하세요</option>
              {% for c in country_list %}
              <option value="{{ c.country_code2 }}" {% if form.country_of_origin.value == c.country_code2 %}selected{% endif %}>{{ c.country_name_ko }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>

      <!-- 보관방법, 용기.포장재질 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- 보관방법 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_storage_method" name="chk_storage_method" class="form-check-input" {% if form.chk_storage_method.value == "Y" %}checked{% endif %}>
            <label for="chk_storage_method" class="m-0">보관방법</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <input type="text" name="storage_method" class="form-control auto-expand" placeholder="보관방법을 입력하거나 내문구를 선택하세요." value="{{ form.storage_method.value|default:'' }}">
          </div>
        </div>
        <!-- 용기.포장재질 -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_frmlc_mtrqlt" name="chk_frmlc_mtrqlt" class="form-check-input" {% if form.chk_frmlc_mtrqlt.value == "Y" %}checked{% endif %}>
            <label for="chk_frmlc_mtrqlt" class="m-0">용기.포장재질</label>
          </div>
          <div style="width:5%;"></div> <!-- 버튼 영역 (비어 있음) -->
          <div style="width:85%;">
            <input type="text" name="frmlc_mtrqlt" class="form-control auto-expand" placeholder="용기.포장재질을 입력하거나 내문구를 선택하세요."value="{{ form.frmlc_mtrqlt.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- 제조원 소재지 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9.6%; min-width:110px;">
          <!-- 제조원 소재지 체크박스 -->
          <input type="checkbox" id="chk_manufacturer_info" name="chk_manufacturer_info" class="form-check-input" 
                 {% if form.chk_manufacturer_info.value == "Y" %}checked{% endif %}>
          <label for="chk_manufacturer_info" class="m-0">제조원 소재지</label>
        </div>
        <div style="min-width:1px;">
          <!-- 제조원 소재지 접기/펼치기 버튼 -->
          <button type="button" class="btn btn-icon" id="toggleManufacturerBtn"
            data-bs-toggle="collapse" data-bs-target="#other-manufacturers" aria-expanded="false"
            aria-controls="other-manufacturers" style="font-size: 1rem; padding: 2px 1px;" title="펼치기">∨</button>
        </div>
        <div style="width:90.4%;">
          <input type="text" name="bssh_nm" class="form-control auto-expand"  placeholder="제조원을 입력하거나 내문구를 선택하세요."value="{{ form.bssh_nm.value|default:'' }}">
        </div>
      </div>

      <!-- 접힘 영역 (항목들 한 줄 정렬) -->
      <div class="collapse mb-2" id="other-manufacturers">
        <!-- 유통전문판매원 -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- 유통전문 판매원 체크박스 -->
            <input type="checkbox" id="chk_distributor_address" name="chk_distributor_address" class="form-check-input" 
                   {% if form.chk_distributor_address.value == "Y" %}checked{% endif %}>
            <label for="chk_distributor_address" class="m-0">유통전문판매원</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="distributor_address" class="form-control auto-expand" placeholder="유통전문판매원을 입력하거나 내문구를 선택하세요."
                  value="{{ form.distributor_address.value|default:'' }}">
          </div>
        </div>

        <!-- 소분원 -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- 소분원 체크박스 -->
            <input type="checkbox" id="chk_repacker_address" name="chk_repacker_address" class="form-check-input" 
                   {% if form.chk_repacker_address.value == "Y" %}checked{% endif %}>
            <label for="chk_repacker_address" class="m-0">소분원</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="repacker_address" class="form-control auto-expand" placeholder="소분원을 입력하거나 내문구를 선택하세요."
                  value="{{ form.repacker_address.value|default:'' }}">
          </div>
        </div>

        <!-- 수입원 -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- 수입원 체크박스 -->
            <input type="checkbox" id="chk_importer_address" name="chk_importer_address" class="form-check-input" 
                   {% if form.chk_importer_address.value == "Y" %}checked{% endif %}>
            <label for="chk_importer_address" class="m-0">수입원</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="importer_address" class="form-control auto-expand" placeholder="수입원을 입력하거나 내문구를 선택하세요."
                  value="{{ form.importer_address.value|default:'' }}">
          </div>
        </div>
      </div>
      
      <!-- 소비기한/품질유지기한/제조연월일/생산연도 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11.6%; min-width:130px;">
          <input type="checkbox" id="chk_date_info" name="chk_date_info" class="form-check-input" {% if form.chk_date_info.value == "Y" %}checked{% endif %}>
          <label for="chk_date_info" class="m-0">소비기한</label>
        </div>
        
        <div style="width:88.4%;">
          <div class="d-flex" style="gap:5px;">
        <select name="date_option" class="form-control select2-date-option" style="width:50%;">
          <option value="소비기한" {% if form.date_option.value == "소비기한" or not form.date_option.value %}selected{% endif %}>소비기한</option>
          <option value="품질유지기한" {% if form.date_option.value == "품질유지기한" %}selected{% endif %}>품질유지기한</option>
          <option value="제조연월일" {% if form.date_option.value == "제조연월일" %}selected{% endif %}>제조연월일</option>
          <option value="생산연도" {% if form.date_option.value == "생산연도" %}selected{% endif %}>생산연도</option>
        </select>
        <input type="text" name="pog_daycnt" class="form-control auto-expand" placeholder="소비기한 등을 입력하거나 내문구를 선택하세요." value="{{ form.pog_daycnt.value|default:'' }}">
          </div>
        </div>
      </div>
      
      <!-- 원재료명(표시) -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9.6%; min-width:110px;">
          <input type="checkbox" id="chk_rawmtrl_nm_display" name="chk_rawmtrl_nm_display" class="form-check-input" {% if form.chk_rawmtrl_nm_display.value == "Y" %}checked{% endif %}>
          <label for="chk_rawmtrl_nm_display" class="m-0">원재료명(표시)</label>
        </div>
        <div style="min-width:1px;">
          <!-- 원재료명(표시) 상세입력 버튼 -->
          <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;" onclick="handleIngredientPopup()" title="상세입력">✚</button>
        </div>
        <div style="width:90.4%;">
          <textarea name="rawmtrl_nm_display" class="form-control auto-expand" rows="2" placeholder="원재료명(표시)을 입력하세요"> {{ form.rawmtrl_nm_display.value|default:form.rawmtrl_nm.value|default:'' }}</textarea>
        </div>
      </div>

      <!-- 원재료명 (참고) - ingredient_relations가 있을 때만 표시 -->
      {% if has_ingredient_relations %}
      <div class="mb-2" id="rawmtrl_nm_section">
        <div class="d-flex align-items-center" style="gap:5px;">
          <div style="width:11%; min-width:130px;">
            <div class="form-check">
              <input type="checkbox" id="chk_rawmtrl_nm" name="chk_rawmtrl_nm" class="form-check-input" 
                     {% if form.chk_rawmtrl_nm.value == "Y" %}checked{% endif %} disabled>
              <label for="chk_rawmtrl_nm" class="m-0">원재료명(참고)</label>
            </div>
          </div>
          <div style="width:89%;">
            <textarea name="rawmtrl_nm" class="form-control auto-expand disabled-textarea" style="flex:1;" 
                      placeholder="원재료명을 입력하세요" disabled readonly>{{ form.rawmtrl_nm.value|default:'' }}</textarea>
          </div>
        </div>  
      </div>
      {% endif %}

      <!-- 주의사항 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11%; min-width:130px;">
          <div class="form-check">
          <input type="checkbox" id="chk_cautions" name="chk_cautions" class="form-check-input" {% if form.chk_cautions.value == "Y" %}checked{% endif %}>
          <label for="chk_cautions" class="m-0">주의사항</label>
          </div>
        </div>
        <div style="width:89%;">
          <textarea name="cautions" 
            class="form-control auto-expand" 
            placeholder="주의사항을 입력하거나 내문구를 선택하세요. 여러 항목을 추가할 수 있습니다.">{{ form.cautions.value|default:'' }}</textarea>
        </div>
      </div>
      <!-- 기타 표시사항 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11%; min-width:130px;">
          <div class="form-check">
          <input type="checkbox" id="chk_additional_info" name="chk_additional_info" class="form-check-input" {% if form.chk_additional_info.value == "Y" %}checked{% endif %}>
          <label for="chk_additional_info" class="m-0">기타표시사항</label>
          </div>
        </div>
        <div style="width:89%;">
          <textarea name="additional_info" 
            class="form-control auto-expand" 
            placeholder="기타 표시사항을 입력하거나 내문구를 선택하세요. 여러 항목을 추가할 수 있습니다.">{{ form.additional_info.value|default:'' }}</textarea>
          </div>
      </div>    

      <!-- 영양성분 -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9%; min-width:105px;">
          <div class="form-check">
            <input type="checkbox" id="chk_calories" name="chk_calories" class="form-check-input" {% if form.chk_calories.value == "Y" %}checked{% endif %}>
            <label for="chk_calories" class="form-check-label m-0">영양성분</label>
          </div>
        </div>
        <div style="min-width:1px;">
          <!-- 영양성분 계산기 버튼 -->
          <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;"
          onclick="openNutritionCalculator()" title="영양성분 계산기">
          🧮
          </button>
        </div>
        <div style="width:91%;">
          <textarea id="nutrition_text"
            name="nutrition_text"
            class="form-control auto-expand"
            placeholder="영양성분 계산기를 통해 입력하세요."
            readonly>{{ form.nutrition_text.value|default:'' }}</textarea>
        </div>
      </div>

      <!-- 영양성분 hidden 필드 -->
      <div style="display: none;">
        <input type="hidden" name="serving_size" value="{{ form.serving_size.value|default:'' }}">
        <input type="hidden" name="serving_size_unit" value="{{ form.serving_size_unit.value|default:'' }}">
        <input type="hidden" name="units_per_package" value="{{ form.units_per_package.value|default:'' }}">
        <input type="hidden" name="nutrition_display_unit" value="{{ form.nutrition_display_unit.value|default:'' }}">
        <input type="hidden" name="calories" value="{{ form.calories.value|default:'' }}">
        <input type="hidden" name="calories_unit" value="{{ form.calories_unit.value|default:'' }}">
        <input type="hidden" name="natriums" value="{{ form.natriums.value|default:'' }}">
        <input type="hidden" name="natriums_unit" value="{{ form.natriums_unit.value|default:'' }}">
        <input type="hidden" name="carbohydrates" value="{{ form.carbohydrates.value|default:'' }}">
        <input type="hidden" name="carbohydrates_unit" value="{{ form.carbohydrates_unit.value|default:'' }}">
        <input type="hidden" name="sugars" value="{{ form.sugars.value|default:'' }}">
        <input type="hidden" name="sugars_unit" value="{{ form.sugars_unit.value|default:'' }}">
        <input type="hidden" name="fats" value="{{ form.fats.value|default:'' }}">
        <input type="hidden" name="fats_unit" value="{{ form.fats_unit.value|default:'' }}">
        <input type="hidden" name="trans_fats" value="{{ form.trans_fats.value|default:'' }}">
        <input type="hidden" name="trans_fats_unit" value="{{ form.trans_fats_unit.value|default:'' }}">
        <input type="hidden" name="saturated_fats" value="{{ form.saturated_fats.value|default:'' }}">
        <input type="hidden" name="saturated_fats_unit" value="{{ form.saturated_fats_unit.value|default:'' }}">
        <input type="hidden" name="cholesterols" value="{{ form.cholesterols.value|default:'' }}">
        <input type="hidden" name="cholesterols_unit" value="{{ form.cholesterols_unit.value|default:'' }}">
        <input type="hidden" name="proteins" value="{{ form.proteins.value|default:'' }}">
        <input type="hidden" name="proteins_unit" value="{{ form.proteins_unit.value|default:'' }}">
      </div>

      </form>
    </div>

    <!-- 우측 패널 탭 구조 -->
    <div id="regulationPanel" class="right-panel collapsible-panel show">
      <!-- 탭 메뉴 -->
      <ul class="nav nav-tabs" id="phraseTab" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active" id="regulation-tab" data-bs-toggle="tab" href="#regulation-content">식품유형별 규정</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" id="myphrases-tab" data-bs-toggle="tab" href="#myphrases-content">항목별 문구 및 규정</a>
        </li>
      </ul>

      <!-- 탭 내용 -->
      <div class="tab-content p-2" style="height:100%;">
        <!-- 관련규정 -->
        <div class="tab-pane fade show active" id="regulation-content" role="tabpanel">
          <textarea name="related_regulations" readonly class="form-control">...</textarea>
        </div>
        <!-- 내문구 -->
        <div class="tab-pane fade" id="myphrases-content" role="tabpanel">
          <div id="myPhraseContainer" style="max-height:400px; overflow-y:auto;">
            <!-- 규정 정보는 JS로 동적 추가 -->
            <div id="myPhraseList" class="d-flex flex-column gap-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}