{% extends 'base.html' %}
{% load static %}

{% block title %}í‘œì‹œì‚¬í•­ ì‘ì„±{% endblock %}

{% block content %}
<!-- jQuery & Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- ì™¸ë¶€ CSS ë° JS íŒŒì¼ ë¡œë“œ -->
<link href="{% static 'css/label_creation.css' %}" rel="stylesheet" />
<!-- ìì£¼ ì‚¬ìš©í•˜ëŠ” ë¬¸êµ¬ ë°ì´í„° ì‚½ì… -->
<script id="phrases-data" type="application/json">
  {{ phrases_json|safe }}
</script>
<script id="regulations-data" type="application/json">
    {{ regulations_json|safe }}
</script>
<script src="{% static 'js/label/label_creation.js' %}"></script>


<!-- ë¼ë²¨ IDë¥¼ JavaScriptì— ì „ë‹¬í•˜ê¸° ìœ„í•œ ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œ -->
<input type="hidden" id="label_id" value="{{ label.my_label_id }}">

<!-- ìƒë‹¨ í—¤ë” -->
<div class="container mt-4" style="padding-bottom: 10px;">
  <div class="d-flex align-items-center justify-content-between" style="gap: 20px;">
    <h2 class="mb-0">í‘œì‹œì‚¬í•­ ì‘ì„±</h2>
    <div class="d-flex align-items-center" style="gap: 10px;">
      <span class="recent-update">ìµœê·¼ ìˆ˜ì •ì¼: {{ label.update_datetime|date:"Y-m-d H:i" }}</span>
      <button type="submit" form="labelForm" class="btn btn-primary">ì €ì¥</button>
      <button type="button" class="btn btn-outline-secondary" onclick="openPreviewPopup()">ë¯¸ë¦¬ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- ì‹í’ˆìœ í˜•/ì¥ê¸°ë³´ì¡´/ì œì¡°ë°©ë²• ì„ íƒ ì˜ì—­ -->
<div id="food-type-section" class="container mb-2" style="display:block;">
  <div class="d-flex align-items-center" style="gap:20px; width:100%;">
    <!-- ì‹í’ˆìœ í˜• ë“œë¡­ë‹¤ìš´ ìˆ˜ì • -->
    <div class="selectable-item" style="flex:1; max-width:25%;">
      <label class="form-label" style="font-size:0.8rem; font-weight:bold;">ì‹í’ˆìœ í˜•</label>
      <div class="d-flex" style="gap:5px; width:100%;">
        <select id="food_group" name="food_group" class="form-control" style="width:50%;">
          <option value="">ëŒ€ë¶„ë¥˜</option>
          {% for group in food_groups %}
          <option value="{{ group }}" {% if label.food_group == group %}selected{% endif %}>{{ group }}</option>
          {% endfor %}
        </select>
        <select id="food_type" name="food_type" class="form-control" style="width:50%;">
          <option value="">ì†Œë¶„ë¥˜</option>
          {% for type in food_types %}
          <option value="{{ type.food_type }}" 
                  data-group="{{ type.food_group }}" 
                  {% if label.food_type == type.food_type %}selected{% endif %}>
            {{ type.food_type }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- ì¥ê¸°ë³´ì¡´ì‹í’ˆ -->
    <div style="flex:1; max-width:30%; display: flex; flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: center; margin-left: 0;">
         <input type="checkbox" id="dummy_long_shelf" style="visibility:hidden; width:18px; margin-right:5px;">
         <label class="form-label" style="font-size:0.8rem; font-weight:bold;">ì¥ê¸°ë³´ì¡´ì‹í’ˆ</label>
      </div>
      <div class="d-flex align-items-center" style="gap:10px; width:100%;">
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_frozen_heated" name="preservation_type" value="frozen_heated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_heated" %}checked{% endif %}>
          <label for="chk_frozen_heated" class="form-check-label" style="font-size:0.8rem;">ëƒ‰ë™(ê°€ì—´)</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_frozen_nonheated" name="preservation_type" value="frozen_nonheated" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "frozen_nonheated" %}checked{% endif %}>
          <label for="chk_frozen_nonheated" class="form-check-label" style="font-size:0.8rem;">ëƒ‰ë™(ë¹„ê°€ì—´)</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_canned" name="preservation_type" value="canned" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "canned" %}checked{% endif %}>
          <label for="chk_canned" class="form-check-label" style="font-size:0.8rem;">í†µ.ë³‘ì¡°ë¦¼</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_retort" name="preservation_type" value="retort" class="form-check-input grp-long-shelf" {% if form.preservation_type.value == "retort" %}checked{% endif %}>
          <label for="chk_retort" class="form-check-label" style="font-size:0.8rem;">ë ˆí† ë¥´íŠ¸</label>
        </div>
      </div>
    </div>
    

    <!-- ì œì¡°ë°©ë²• -->
    <div style="flex:1; max-width:40%; display: flex; flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: center; margin-left: 0;">
         <input type="checkbox" id="dummy_manufacturing" style="visibility:hidden; width:18px; margin-right:5px;">
         <label class="form-label" style="font-size:0.8rem; font-weight:bold; ">ì œì¡°ë°©ë²•</label>
      </div>
      <div class="d-flex align-items-center" style="gap:10px; flex-wrap: nowrap; width:100%;">
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_sanitized" name="processing_method" value="sanitized" class="form-check-input grp-sterilization" {% if form.processing_method.value == "sanitized" %}checked{% endif %}>
          <label for="chk_sanitized" class="form-check-label" style="font-size:0.8rem;">ì‚´ê· </label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_aseptic" name="processing_method" value="aseptic" class="form-check-input grp-sterilization" {% if form.processing_method.value == "aseptic" %}checked{% endif %}>
          <label for="chk_aseptic" class="form-check-label" style="font-size:0.8rem;">ë©¸ê· </label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_yutang" name="processing_method" value="yutang" class="form-check-input grp-sterilization" {% if form.processing_method.value == "yutang" %}checked{% endif %}>
          <label for="chk_yutang" class="form-check-label" style="font-size:0.8rem;">ìœ íƒ•/ìœ ì²˜ë¦¬</label>
        </div>
        <div class="form-check" style="margin:0;">
          <input type="checkbox" id="chk_sterilization_other" name="chk_sterilization_other" class="form-check-input" {% if form.processing_condition.value %}checked{% endif %}>
          <label for="chk_sterilization_other" class="form-check-label" style="font-size:0.8rem;">ì¡°ê±´</label>
        </div>
        <input type="text" name="processing_condition" class="form-control" placeholder="ì¡°ê±´ ìƒì„¸" style="width:120px;" value="{{ form.processing_condition.value|default:'' }}">
      </div>
    </div>
  </div>
</div>

<hr class="mb-2">

<!-- ì‹í’ˆìœ í˜• ìš”ì•½ -->
<div class="container mb-2 d-flex justify-content-between align-items-center">
  <div id="selected-info" style="font-weight:bold; font-size:0.9rem;">ì‹í’ˆìœ í˜• :</div>
  <div class="d-flex align-items-center" style="gap: 5px;">
    <!-- ë‚´ ë¬¸êµ¬ ê´€ë¦¬ ë²„íŠ¼ -->
    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="openPhrasePopup()" title="ë‚´ ë¬¸êµ¬ ê´€ë¦¬">
      ë‚´ ë¬¸êµ¬ ê´€ë¦¬
    </button>
    <!-- ì‹í’ˆìœ í˜• ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ -->
    <button id="toggleFoodTypeBtn" class="btn btn-icon" type="button" title="ì ‘ê¸°" style="font-size: 1rem;">âˆ§</button>
    <!-- ìš°ì¸¡ íŒ¨ë„ ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ -->
    <button id="toggleRegulationBtn" class="btn btn-icon" title="ì ‘ê¸°" style="font-size: 1rem;">â¯</button>
  </div>
</div>

<!-- ë³¸ë¬¸ ì¢Œìš° íŒ¨ë„ ì˜ì—­ -->
<div class="container">
  <div class="layout-container" style="display: flex; gap: 20px; align-items: flex-start;">
    <!-- ì¢Œì¸¡: ì…ë ¥ íŒ¨ë„ -->
    <div class="left-panel flex-grow-1 position-relative" style="flex-basis: 70%;">
      <form method="post" id="labelForm">
        {% csrf_token %}
        
        <!-- ì‹í’ˆìœ í˜• hidden í•„ë“œ ì¶”ê°€ -->
        <input type="hidden" id="hidden_food_group" name="food_group" value="{{ label.food_group }}">
        <input type="hidden" id="hidden_food_type" name="food_type" value="{{ label.food_type }}">
        
        <!-- ì¥ê¸°ë³´ì¡´ì‹í’ˆ, ì œì¡°ë°©ë²• hidden í•„ë“œ ì¶”ê°€ -->
        <input type="hidden" id="hidden_preservation_type" name="preservation_type" value="{{ label.preservation_type }}">
        <input type="hidden" id="hidden_processing_method" name="processing_method" value="{{ label.processing_method }}">
        <input type="hidden" id="hidden_processing_condition" name="processing_condition" value="{{ label.processing_condition }}">
        
        <!-- ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì €ì¥ìš© hidden í•„ë“œ -->
        <input type="hidden" name="chckd_label_nm" value="{{ label.chckd_label_nm|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_dcnm" value="{{ label.chckd_prdlst_dcnm|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_nm" value="{{ label.chckd_prdlst_nm|default:'Y' }}">
        <input type="hidden" name="chckd_ingredients_info" value="{{ label.chckd_ingredients_info|default:'N' }}">
        <input type="hidden" name="chckd_content_weight" value="{{ label.chckd_content_weight|default:'Y' }}">
        <input type="hidden" name="chckd_weight_calorie" value="{{ label.chckd_weight_calorie|default:'N' }}">
        <input type="hidden" name="chckd_prdlst_report_no" value="{{ label.chckd_prdlst_report_no|default:'N' }}">
        <input type="hidden" name="chckd_country_of_origin" value="{{ label.chckd_country_of_origin|default:'N' }}">
        <input type="hidden" name="chckd_storage_method" value="{{ label.chckd_storage_method|default:'N' }}">
        <input type="hidden" name="chckd_frmlc_mtrqlt" value="{{ label.chckd_frmlc_mtrqlt|default:'N' }}">
        <input type="hidden" name="chckd_manufacturer_info" value="{{ label.chckd_manufacturer_info|default:'Y' }}">
        <input type="hidden" name="chckd_distributor_address" value="{{ label.chckd_distributor_address|default:'N' }}">
        <input type="hidden" name="chckd_repacker_address" value="{{ label.chckd_repacker_address|default:'N' }}">
        <input type="hidden" name="chckd_importer_address" value="{{ label.chckd_importer_address|default:'N' }}">
        <input type="hidden" name="chckd_date_info" value="{{ label.chckd_date_info|default:'Y' }}">
        <input type="hidden" name="chckd_rawmtrl_nm_display" value="{{ label.chckd_rawmtrl_nm_display|default:'N' }}">
        <input type="hidden" name="chckd_cautions" value="{{ label.chckd_cautions|default:'N' }}">
        <input type="hidden" name="chckd_additional_info" value="{{ label.chckd_additional_info|default:'N' }}">
        <input type="hidden" name="chckd_nutrition_text" value="{{ label.chckd_nutrition_text|default:'N' }}">

      <!-- ë¼ë²¨ëª… + ì‹í’ˆìœ í˜• í•œ ì¤„ êµ¬ì„± -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- ë¼ë²¨ëª… -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- ë¼ë²¨ëª… ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_label_nm" name="chk_label_nm" class="form-check-input" 
                   {% if form.chk_label_nm.value == "Y" %}checked{% endif %}>
            <label for="chk_label_nm" class="m-0">ë¼ë²¨ëª…</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="my_label_name" class="form-control auto-expand" placeholder="ë¼ë²¨ëª…ì„ ì…ë ¥í•˜ì„¸ìš”." value="{{ form.my_label_name.value|default:'' }}">
          </div>
        </div>
        <!-- ì‹í’ˆìœ í˜• -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_prdlst_dcnm" name="chk_prdlst_dcnm" class="form-check-input" {% if form.chk_prdlst_dcnm.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_dcnm" class="m-0">ì‹í’ˆìœ í˜•</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="prdlst_dcnm" class="form-control auto-expand" placeholder="ìƒë‹¨ì˜ ì‹í’ˆìœ í˜•ì„ ì°¸ê³ í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”." value="{{ form.prdlst_dcnm.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- ì œí’ˆëª…, ì„±ë¶„ëª… ë° í•¨ëŸ‰ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- ì œí’ˆëª… -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- ì œí’ˆëª… ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_prdlst_nm" name="chk_prdlst_nm" class="form-check-input" 
                   {% if form.chk_prdlst_nm.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_nm" class="m-0">ì œí’ˆëª…</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="prdlst_nm" class="form-control auto-expand" placeholder="ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”." value="{{ form.prdlst_nm.value|default:'' }}">
          </div>
        </div>
        <!-- ì„±ë¶„ëª… ë° í•¨ëŸ‰ -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- ì„±ë¶„ëª… ë° í•¨ëŸ‰ ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_ingredients_info" name="chk_ingredients_info" class="form-check-input" 
                   {% if form.chk_ingredients_info.value == "Y" %}checked{% endif %}>
            <label for="chk_ingredients_info" class="m-0">ì„±ë¶„ëª… ë° í•¨ëŸ‰</label>
          </div>
          <div style="width:5%;"></div>
          <div style="width:85%;">
            <input type="text" name="ingredient_info" class="form-control auto-expand" placeholder="ì œí’ˆëª…ì— ì›ì¬ë£Œëª…ì„ ì‚¬ìš©í•œ ê²½ìš° ì…ë ¥í•˜ì„¸ìš”." value="{{ form.ingredient_info.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- ë‚´ìš©ëŸ‰, ë‚´ìš©ëŸ‰(ì—´ëŸ‰) -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- ë‚´ìš©ëŸ‰ -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <!-- ë‚´ìš©ëŸ‰ ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_content_weight" name="chk_content_weight" class="form-check-input" 
                   {% if form.chk_content_weight.value == "Y" %}checked{% endif %}>
            <label for="chk_content_weight" class="m-0">ë‚´ìš©ëŸ‰</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <input type="text" name="content_weight" class="form-control auto-expand" placeholder="ë‚´ìš©ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”." value="{{ form.content_weight.value|default:'' }}">
          </div>
        </div>
        <!-- ë‚´ìš©ëŸ‰(ì—´ëŸ‰) -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_weight_calorie" name="chk_weight_calorie" class="form-check-input" {% if form.chk_weight_calorie.value == "Y" %}checked{% endif %}>
            <label for="chk_weight_calorie" class="m-0">ë‚´ìš©ëŸ‰(ì—´ëŸ‰)</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <input type="text" name="weight_calorie" class="form-control auto-expand" placeholder="ë‚´ìš©ëŸ‰(ì—´ëŸ‰) í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”." value="{{ form.weight_calorie.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- í’ˆëª©ë³´ê³ ë²ˆí˜¸, ì›ì‚°ì§€ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- í’ˆëª©ë³´ê³ ë²ˆí˜¸ -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_prdlst_report_no" name="chk_prdlst_report_no" class="form-check-input" {% if form.chk_prdlst_report_no.value == "Y" %}checked{% endif %}>
            <label for="chk_prdlst_report_no" class="m-0">í’ˆëª©ë³´ê³ ë²ˆí˜¸</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <input type="text" name="prdlst_report_no" class="form-control" value="{{ form.prdlst_report_no.value|default:'' }}">
          </div>
        </div>
        <!-- ì›ì‚°ì§€ -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_country_of_origin" name="chk_country_of_origin" class="form-check-input" {% if form.chk_country_of_origin.value == "Y" %}checked{% endif %}>
            <label for="chk_country_of_origin" class="m-0">ì›ì‚°ì§€</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <select name="country_of_origin" class="form-control select2-country">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              {% for c in country_list %}
              <option value="{{ c.country_code2 }}" {% if form.country_of_origin.value == c.country_code2 %}selected{% endif %}>{{ c.country_name_ko }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>

      <!-- ë³´ê´€ë°©ë²•, ìš©ê¸°.í¬ì¥ì¬ì§ˆ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <!-- ë³´ê´€ë°©ë²• -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_storage_method" name="chk_storage_method" class="form-check-input" {% if form.chk_storage_method.value == "Y" %}checked{% endif %}>
            <label for="chk_storage_method" class="m-0">ë³´ê´€ë°©ë²•</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <input type="text" name="storage_method" class="form-control auto-expand" placeholder="ë³´ê´€ë°©ë²•ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”." value="{{ form.storage_method.value|default:'' }}">
          </div>
        </div>
        <!-- ìš©ê¸°.í¬ì¥ì¬ì§ˆ -->
        <div class="d-flex align-items-center" style="flex:1; gap:5px;">
          <div style="width:10%; min-width:110px;">
            <input type="checkbox" id="chk_frmlc_mtrqlt" name="chk_frmlc_mtrqlt" class="form-check-input" {% if form.chk_frmlc_mtrqlt.value == "Y" %}checked{% endif %}>
            <label for="chk_frmlc_mtrqlt" class="m-0">ìš©ê¸°.í¬ì¥ì¬ì§ˆ</label>
          </div>
          <div style="width:5%;"></div> <!-- ë²„íŠ¼ ì˜ì—­ (ë¹„ì–´ ìˆìŒ) -->
          <div style="width:85%;">
            <input type="text" name="frmlc_mtrqlt" class="form-control auto-expand" placeholder="ìš©ê¸°.í¬ì¥ì¬ì§ˆì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”."value="{{ form.frmlc_mtrqlt.value|default:'' }}">
          </div>
        </div>
      </div>

      <!-- ì œì¡°ì› ì†Œì¬ì§€ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9.6%; min-width:110px;">
          <!-- ì œì¡°ì› ì†Œì¬ì§€ ì²´í¬ë°•ìŠ¤ -->
          <input type="checkbox" id="chk_manufacturer_info" name="chk_manufacturer_info" class="form-check-input" 
                 {% if form.chk_manufacturer_info.value == "Y" %}checked{% endif %}>
          <label for="chk_manufacturer_info" class="m-0">ì œì¡°ì› ì†Œì¬ì§€</label>
        </div>
        <div style="min-width:1px;">
          <!-- ì œì¡°ì› ì†Œì¬ì§€ ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ -->
          <button type="button" class="btn btn-icon" id="toggleManufacturerBtn"
            data-bs-toggle="collapse" data-bs-target="#other-manufacturers" aria-expanded="false"
            aria-controls="other-manufacturers" style="font-size: 1rem; padding: 2px 1px;" title="í¼ì¹˜ê¸°">âˆ¨</button>
        </div>
        <div style="width:90.4%;">
          <input type="text" name="bssh_nm" class="form-control auto-expand"  placeholder="ì œì¡°ì›ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”."value="{{ form.bssh_nm.value|default:'' }}">
        </div>
      </div>

      <!-- ì ‘í˜ ì˜ì—­ (í•­ëª©ë“¤ í•œ ì¤„ ì •ë ¬) -->
      <div class="collapse mb-2" id="other-manufacturers">
        <!-- ìœ í†µì „ë¬¸íŒë§¤ì› -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- ìœ í†µì „ë¬¸ íŒë§¤ì› ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_distributor_address" name="chk_distributor_address" class="form-check-input" 
                   {% if form.chk_distributor_address.value == "Y" %}checked{% endif %}>
            <label for="chk_distributor_address" class="m-0">ìœ í†µì „ë¬¸íŒë§¤ì›</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="distributor_address" class="form-control auto-expand" placeholder="ìœ í†µì „ë¬¸íŒë§¤ì›ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”."
                  value="{{ form.distributor_address.value|default:'' }}">
          </div>
        </div>

        <!-- ì†Œë¶„ì› -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- ì†Œë¶„ì› ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_repacker_address" name="chk_repacker_address" class="form-check-input" 
                   {% if form.chk_repacker_address.value == "Y" %}checked{% endif %}>
            <label for="chk_repacker_address" class="m-0">ì†Œë¶„ì›</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="repacker_address" class="form-control auto-expand" placeholder="ì†Œë¶„ì›ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”."
                  value="{{ form.repacker_address.value|default:'' }}">
          </div>
        </div>

        <!-- ìˆ˜ì…ì› -->
        <div class="d-flex align-items-center mb-2" style="gap:5px;">
          <div style="width:11.1%; min-width:130px;">
            <!-- ìˆ˜ì…ì› ì²´í¬ë°•ìŠ¤ -->
            <input type="checkbox" id="chk_importer_address" name="chk_importer_address" class="form-check-input" 
                   {% if form.chk_importer_address.value == "Y" %}checked{% endif %}>
            <label for="chk_importer_address" class="m-0">ìˆ˜ì…ì›</label>
          </div>
          <div style="width:88.9%;">
            <input type="text" name="importer_address" class="form-control auto-expand" placeholder="ìˆ˜ì…ì›ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”."
                  value="{{ form.importer_address.value|default:'' }}">
          </div>
        </div>
      </div>
      
      <!-- ì†Œë¹„ê¸°í•œ/í’ˆì§ˆìœ ì§€ê¸°í•œ/ì œì¡°ì—°ì›”ì¼/ìƒì‚°ì—°ë„ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11.6%; min-width:130px;">
          <input type="checkbox" id="chk_date_info" name="chk_date_info" class="form-check-input" {% if form.chk_date_info.value == "Y" %}checked{% endif %}>
          <label for="chk_date_info" class="m-0">ì†Œë¹„ê¸°í•œ</label>
        </div>
        
        <div style="width:88.4%;">
          <div class="d-flex" style="gap:5px;">
        <select name="date_option" class="form-control select2-date-option" style="width:50%;">
          <option value="ì†Œë¹„ê¸°í•œ" {% if form.date_option.value == "ì†Œë¹„ê¸°í•œ" or not form.date_option.value %}selected{% endif %}>ì†Œë¹„ê¸°í•œ</option>
          <option value="í’ˆì§ˆìœ ì§€ê¸°í•œ" {% if form.date_option.value == "í’ˆì§ˆìœ ì§€ê¸°í•œ" %}selected{% endif %}>í’ˆì§ˆìœ ì§€ê¸°í•œ</option>
          <option value="ì œì¡°ì—°ì›”ì¼" {% if form.date_option.value == "ì œì¡°ì—°ì›”ì¼" %}selected{% endif %}>ì œì¡°ì—°ì›”ì¼</option>
          <option value="ìƒì‚°ì—°ë„" {% if form.date_option.value == "ìƒì‚°ì—°ë„" %}selected{% endif %}>ìƒì‚°ì—°ë„</option>
        </select>
        <input type="text" name="pog_daycnt" class="form-control auto-expand" placeholder="ì†Œë¹„ê¸°í•œ ë“±ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”." value="{{ form.pog_daycnt.value|default:'' }}">
          </div>
        </div>
      </div>
      
      <!-- ì›ì¬ë£Œëª…(í‘œì‹œ) -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9.6%; min-width:110px;">
          <input type="checkbox" id="chk_rawmtrl_nm_display" name="chk_rawmtrl_nm_display" class="form-check-input" {% if form.chk_rawmtrl_nm_display.value == "Y" %}checked{% endif %}>
          <label for="chk_rawmtrl_nm_display" class="m-0">ì›ì¬ë£Œëª…(í‘œì‹œ)</label>
        </div>
        <div style="min-width:1px;">
          <!-- ì›ì¬ë£Œëª…(í‘œì‹œ) ìƒì„¸ì…ë ¥ ë²„íŠ¼ -->
          <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;" onclick="handleIngredientPopup()" title="ìƒì„¸ì…ë ¥">âœš</button>
        </div>
        <div style="width:90.4%;">
          <textarea name="rawmtrl_nm_display" class="form-control auto-expand" rows="2" placeholder="ì›ì¬ë£Œëª…(í‘œì‹œ)ì„ ì…ë ¥í•˜ì„¸ìš”"> {{ form.rawmtrl_nm_display.value|default:form.rawmtrl_nm.value|default:'' }}</textarea>
        </div>
      </div>

      <!-- ì›ì¬ë£Œëª… (ì°¸ê³ ) - ingredient_relationsê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ -->
      {% if has_ingredient_relations %}
      <div class="mb-2" id="rawmtrl_nm_section">
        <div class="d-flex align-items-center" style="gap:5px;">
          <div style="width:11%; min-width:130px;">
            <div class="form-check">
              <input type="checkbox" id="chk_rawmtrl_nm" name="chk_rawmtrl_nm" class="form-check-input" 
                     {% if form.chk_rawmtrl_nm.value == "Y" %}checked{% endif %} disabled>
              <label for="chk_rawmtrl_nm" class="m-0">ì›ì¬ë£Œëª…(ì°¸ê³ )</label>
            </div>
          </div>
          <div style="width:89%;">
            <textarea name="rawmtrl_nm" class="form-control auto-expand disabled-textarea" style="flex:1;" 
                      placeholder="ì›ì¬ë£Œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" disabled readonly>{{ form.rawmtrl_nm.value|default:'' }}</textarea>
          </div>
        </div>  
      </div>
      {% endif %}

      <!-- ì£¼ì˜ì‚¬í•­ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11%; min-width:130px;">
          <div class="form-check">
          <input type="checkbox" id="chk_cautions" name="chk_cautions" class="form-check-input" {% if form.chk_cautions.value == "Y" %}checked{% endif %}>
          <label for="chk_cautions" class="m-0">ì£¼ì˜ì‚¬í•­</label>
          </div>
        </div>
        <div style="width:89%;">
          <textarea name="cautions" 
            class="form-control auto-expand" 
            placeholder="ì£¼ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”. ì—¬ëŸ¬ í•­ëª©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">{{ form.cautions.value|default:'' }}</textarea>
        </div>
      </div>
      <!-- ê¸°íƒ€ í‘œì‹œì‚¬í•­ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:11%; min-width:130px;">
          <div class="form-check">
          <input type="checkbox" id="chk_additional_info" name="chk_additional_info" class="form-check-input" {% if form.chk_additional_info.value == "Y" %}checked{% endif %}>
          <label for="chk_additional_info" class="m-0">ê¸°íƒ€í‘œì‹œì‚¬í•­</label>
          </div>
        </div>
        <div style="width:89%;">
          <textarea name="additional_info" 
            class="form-control auto-expand" 
            placeholder="ê¸°íƒ€ í‘œì‹œì‚¬í•­ì„ ì…ë ¥í•˜ê±°ë‚˜ ë‚´ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”. ì—¬ëŸ¬ í•­ëª©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">{{ form.additional_info.value|default:'' }}</textarea>
          </div>
      </div>    

      <!-- ì˜ì–‘ì„±ë¶„ -->
      <div class="d-flex align-items-center mb-2" style="gap:5px;">
        <div style="width:9%; min-width:105px;">
          <div class="form-check">
            <input type="checkbox" id="chk_calories" name="chk_calories" class="form-check-input" {% if form.chk_calories.value == "Y" %}checked{% endif %}>
            <label for="chk_calories" class="form-check-label m-0">ì˜ì–‘ì„±ë¶„</label>
          </div>
        </div>
        <div style="min-width:1px;">
          <!-- ì˜ì–‘ì„±ë¶„ ê³„ì‚°ê¸° ë²„íŠ¼ -->
          <button type="button" class="btn btn-icon" style="font-size: 0.9rem; padding: 1px 1px;"
          onclick="openNutritionCalculator()" title="ì˜ì–‘ì„±ë¶„ ê³„ì‚°ê¸°">
          ğŸ§®
          </button>
        </div>
        <div style="width:91%;">
          <textarea id="nutrition_text"
            name="nutrition_text"
            class="form-control auto-expand"
            placeholder="ì˜ì–‘ì„±ë¶„ ê³„ì‚°ê¸°ë¥¼ í†µí•´ ì…ë ¥í•˜ì„¸ìš”."
            readonly>{{ form.nutrition_text.value|default:'' }}</textarea>
        </div>
      </div>

      <!-- ì˜ì–‘ì„±ë¶„ hidden í•„ë“œ -->
      <div style="display: none;">
        <input type="hidden" name="serving_size" value="{{ form.serving_size.value|default:'' }}">
        <input type="hidden" name="serving_size_unit" value="{{ form.serving_size_unit.value|default:'' }}">
        <input type="hidden" name="units_per_package" value="{{ form.units_per_package.value|default:'' }}">
        <input type="hidden" name="nutrition_display_unit" value="{{ form.nutrition_display_unit.value|default:'' }}">
        <input type="hidden" name="calories" value="{{ form.calories.value|default:'' }}">
        <input type="hidden" name="calories_unit" value="{{ form.calories_unit.value|default:'' }}">
        <input type="hidden" name="natriums" value="{{ form.natriums.value|default:'' }}">
        <input type="hidden" name="natriums_unit" value="{{ form.natriums_unit.value|default:'' }}">
        <input type="hidden" name="carbohydrates" value="{{ form.carbohydrates.value|default:'' }}">
        <input type="hidden" name="carbohydrates_unit" value="{{ form.carbohydrates_unit.value|default:'' }}">
        <input type="hidden" name="sugars" value="{{ form.sugars.value|default:'' }}">
        <input type="hidden" name="sugars_unit" value="{{ form.sugars_unit.value|default:'' }}">
        <input type="hidden" name="fats" value="{{ form.fats.value|default:'' }}">
        <input type="hidden" name="fats_unit" value="{{ form.fats_unit.value|default:'' }}">
        <input type="hidden" name="trans_fats" value="{{ form.trans_fats.value|default:'' }}">
        <input type="hidden" name="trans_fats_unit" value="{{ form.trans_fats_unit.value|default:'' }}">
        <input type="hidden" name="saturated_fats" value="{{ form.saturated_fats.value|default:'' }}">
        <input type="hidden" name="saturated_fats_unit" value="{{ form.saturated_fats_unit.value|default:'' }}">
        <input type="hidden" name="cholesterols" value="{{ form.cholesterols.value|default:'' }}">
        <input type="hidden" name="cholesterols_unit" value="{{ form.cholesterols_unit.value|default:'' }}">
        <input type="hidden" name="proteins" value="{{ form.proteins.value|default:'' }}">
        <input type="hidden" name="proteins_unit" value="{{ form.proteins_unit.value|default:'' }}">
      </div>

      </form>
    </div>

    <!-- ìš°ì¸¡ íŒ¨ë„ íƒ­ êµ¬ì¡° -->
    <div id="regulationPanel" class="right-panel collapsible-panel show">
      <!-- íƒ­ ë©”ë‰´ -->
      <ul class="nav nav-tabs" id="phraseTab" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active" id="regulation-tab" data-bs-toggle="tab" href="#regulation-content">ì‹í’ˆìœ í˜•ë³„ ê·œì •</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" id="myphrases-tab" data-bs-toggle="tab" href="#myphrases-content">í•­ëª©ë³„ ë¬¸êµ¬ ë° ê·œì •</a>
        </li>
      </ul>

      <!-- íƒ­ ë‚´ìš© -->
      <div class="tab-content p-2" style="height:100%;">
        <!-- ê´€ë ¨ê·œì • -->
        <div class="tab-pane fade show active" id="regulation-content" role="tabpanel">
          <textarea name="related_regulations" readonly class="form-control">...</textarea>
        </div>
        <!-- ë‚´ë¬¸êµ¬ -->
        <div class="tab-pane fade" id="myphrases-content" role="tabpanel">
          <div id="myPhraseContainer" style="max-height:400px; overflow-y:auto;">
            <!-- ê·œì • ì •ë³´ëŠ” JSë¡œ ë™ì  ì¶”ê°€ -->
            <div id="myPhraseList" class="d-flex flex-column gap-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}