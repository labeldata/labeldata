{% extends 'base.html' %}
{% load static %}
{% block title %}메인 화면{% endblock %}

{% block content %}
<!-- 시스템 소개 영역 -->
<div class="system-intro">
    <div class="intro-box">
        <h1 class="intro-title">"간편한 표시사항 연구소"에 오신 것을 환영합니다.</h1>
        <p class="intro-description">
            표시사항을 제작하기 위한 다양한 기능을 제공합니다.
        </p>
        <!-- [수정] 튜토리얼 시작 영역 통합 -->
        <div id="start-tutorial-area">
            <h2 class="tutorial-area-title">「시스템 튜토리얼 바로가기」</h2>
            <ul class="intro-list">
                <li>제품 조회: 국내외 식품 정보 검색 및 저장(내 원료, 표시사항)</li>
                <li>원료 관리: 내 원료 저장, 상세정보 입력(표시명, 알레르기 등)</li>
                <li>표시사항 관리: 표시사항 작성, 규정검증, 미리보기, 다운로드
                    <ul class="sub-list">
                        <li>식품유형에 따른 필수 항목 추천</li>
                        <li>자주 사용하는 문구 추천 및 불러오기</li>
                        <li>원료 함량에 따른 원재료명 자동 생성·검증</li>
                        <li>영양성분 계산기</li>
                        <li>서식 미리보기 및 규정 검증</li>
                        <li>PDF 저장 및 엑셀 다운로드</li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="highlight-feature">
            <span>새로운 기능 곧 공개! </span>
            <a href="{% url 'board:list' %}" class="cta-button">게시판에서 아이디어 공유해주세요 😊</a>
        </div>
    </div>
</div>

<!-- 튜토리얼 오버레이 UI -->
<div id="tutorial-overlay" style="display: none;">
    <button id="tutorial-close-btn" class="tutorial-btn">&times;</button>
    <button id="tutorial-prev-btn" class="tutorial-btn tutorial-nav-btn">&lt;</button>
    <button id="tutorial-next-btn" class="tutorial-btn tutorial-nav-btn">&gt;</button>

    <div class="tutorial-content-main">
        <div id="tutorial-text-content">
            <h3 id="tutorial-title"></h3>
            <p id="tutorial-description"></p>
        </div>
        <img id="tutorial-image" src="" alt="튜토리얼 단계별 예시 화면">
    </div>

    <div id="tutorial-progress-bar"></div>
</div>


<style>
/* --- 기존 스타일 --- */
.system-intro {
    background-color: #f8fafc; padding: 2rem; display: flex; align-items: center; justify-content: center;
    margin-top: 4rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); min-height: auto;
}
.intro-box { max-width: 800px; text-align: center; }
.intro-title {
    font-size: clamp(1.5rem, 3vw, 2.5rem); font-weight: 700; color: #1a3c34;
    margin-bottom: 1rem; white-space: nowrap;
}
.intro-description {
    font-size: clamp(1rem, 2vw, 1.2rem); color: #4a5568; margin-bottom: 2rem; line-height: 1.6;
}

/* [추가] 튜토리얼 시작 영역 스타일 */
#start-tutorial-area {
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    cursor: pointer;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    background-color: #ffffff;
}
#start-tutorial-area:hover {
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    transform: translateY(-5px);
}
.tutorial-area-title {
    font-size: 1.3rem;
    color: #38b2ac;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 1rem;
}

.intro-list { list-style: none; padding: 0; text-align: left; font-size: clamp(0.9rem, 1.5vw, 1.1rem); color: #2d3748; line-height: 1.6; }
.intro-list li { margin-bottom: 0.5rem; }
.sub-list { margin-top: 0.5rem; margin-left: 1.5rem; list-style-type: disc; }
.sub-list li { font-size: clamp(0.85rem, 1.4vw, 1rem); color: #4a5568; }
.highlight-feature {
    background-color: #e6fffa; padding: 1rem; border-radius: 8px; display: flex;
    align-items: center; justify-content: space-between; flex-wrap: wrap; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
.highlight-feature span { font-size: clamp(1rem, 1.5vw, 1.1rem); font-weight: 600; color: #2b6cb0; }
.cta-button {
    display: inline-block; background-color: #38b2ac; color: white; padding: 0.625rem 1.25rem;
    border-radius: 6px; text-decoration: none; font-size: clamp(0.9rem, 1.5vw, 1rem); transition: background-color 0.3s ease;
    border: none; cursor: pointer;
}
.cta-button:hover { background-color: #319795; }

/* --- 튜토리얼 오버레이 스타일 --- */
.tutorial-highlight {
    position: relative;
    z-index: 1001;
    box-shadow: 0 0 0 3px #38b2ac;
    border-radius: 5px;
    transition: box-shadow 0.3s ease-in-out;
}
#tutorial-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.85); z-index: 1000; display: flex;
    align-items: center; justify-content: center; flex-direction: column;
    padding-top: 70px; box-sizing: border-box;
}
.tutorial-btn { background: none; border: none; color: white; cursor: pointer; font-family: 'Arial', sans-serif; }
#tutorial-close-btn {
    position: absolute; top: 40px; right: 30px; font-size: 3rem;
    opacity: 0.8; transition: opacity 0.2s;
}
#tutorial-close-btn:hover { opacity: 1; }
.tutorial-nav-btn {
    position: absolute; top: 50%; transform: translateY(-50%); font-size: 3rem;
    padding: 10px 20px; border-radius: 10px; background-color: rgba(0, 0, 0, 0.3);
    transition: background-color 0.2s;
}
.tutorial-nav-btn:hover { background-color: rgba(0, 0, 0, 0.5); }
#tutorial-prev-btn { left: 20px; }
#tutorial-next-btn { right: 20px; }
.tutorial-content-main {
    max-width: 70vw; max-height: calc(85vh - 70px); display: flex;
    flex-direction: column; align-items: center;
}
#tutorial-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; }
#tutorial-text-content {
    color: white; text-align: center; margin-bottom: 20px; background-color: rgba(0, 0, 0, 0.4);
    padding: 15px; border-radius: 8px; width: 100%; box-sizing: border-box;
}
#tutorial-title { margin: 0 0 10px 0; font-size: 1.5rem; }
#tutorial-description { margin: 0; font-size: 1.1rem; line-height: 1.5; }
#tutorial-progress-bar { position: absolute; bottom: 30px; display: flex; gap: 8px; }
.progress-dot {
    width: 12px; height: 12px; border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.4); transition: background-color 0.3s;
}
.progress-dot.active { background-color: white; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // [수정] 튜토리얼 시작 버튼을 새로운 영역으로 변경
    const startBtn = document.getElementById('start-tutorial-area');
    if (!startBtn) return;

    const overlay = document.getElementById('tutorial-overlay');
    const closeBtn = document.getElementById('tutorial-close-btn');
    const nextBtn = document.getElementById('tutorial-next-btn');
    const prevBtn = document.getElementById('tutorial-prev-btn');
    
    const titleEl = document.getElementById('tutorial-title');
    const imageEl = document.getElementById('tutorial-image');
    const descriptionEl = document.getElementById('tutorial-description');
    const progressBar = document.getElementById('tutorial-progress-bar');

    const tutorialSteps = [
        { element: '#nav-food-item-list', title: '1-1. 제품 조회 : 국내/수입제품 검색', image: "{% static 'img/tutorial/step-1-1.png' %}", description: '150만 건의 국내외 식품의 표시사항을 확인할 수 있습니다.' },
        { element: '#nav-food-item-list', title: '1-2. 제품 조회 : 원료와 제품을 각각 복사', image: "{% static 'img/tutorial/step-1-2.png' %}", description: '검색한 제품의 정보를 ①클릭 한 번으로 내 원료 또는 내 표시사항으로 간편하게 복사 후 ②확인할 수 있습니다.' },
        { element: '#nav-ingredient-management', title: '2-1. 원료 관리 : 원료의 상세 정보를 입력', image: "{% static 'img/tutorial/step-2-1.png' %}", description: '저장된 원료의 알레르기, 원산지 등 상세 정보를 관리할 수 있습니다.' },
        { element: '#nav-ingredient-management', title: '2-2. 원료 관리 : 원료 데이터 엑셀 업로드', image: "{% static 'img/tutorial/step-2-2.png' %}", description: '엑셀 양식을 다운로드하여 여러 품목을 한 번에 업로드하고 관리할 수 있습니다.' },
        { element: '#nav-label-management', title: '3-1. 표시사항 관리 : 표시사항 작성 대상 선택', image: "{% static 'img/tutorial/step-3-1.png' %}", description: '새로운 표시사항을 만들거나, 기존에 저장된 표시사항을 복사하여 수정할 수 있습니다.' },
        { element: '#nav-label-management', title: '3-2. 표시사항 관리 : 필수항목 자동 추천', image: "{% static 'img/tutorial/step-3-2.png' %}", description: '식품유형을 선택하면 관련 규정에 따른 필수 표시항목이 자동으로 추천됩니다.' },
        { element: '#nav-label-management', title: '3-3. 표시사항 관리 : 자주 사용하는 문구 설정', image: "{% static 'img/tutorial/step-3-3.png' %}", description: '보관방법, 주의사항 등 자주 사용하는 문구를 저장해두고 간편하게 불러올 수 있습니다.' },
        { element: '#nav-label-management', title: '3-4. 표시사항 관리 : 원재료명 자동 생성', image: "{% static 'img/tutorial/step-3-4.png' %}", description: '원료와 함량을 ①추가, ② 비율 입력, ③ 표시규칙 조정하면 원재료명 예시가 자동으로 생성됩니다.' },
        { element: '#nav-label-management', title: '3-5. 표시사항 관리 : 미리보기 및 설정 조정', image: "{% static 'img/tutorial/step-3-5.png' %}", description: '작성된 표시사항을 미리보기에서 ①설정 변경하고. ②분리배출 마크 추가 등을 할 수 있습니다.' },
        { element: '#nav-label-management', title: '3-6. 표시사항 관리 : 규정 검증 및 PDF 저장', image: "{% static 'img/tutorial/step-3-6.png' %}", description: '완성된 표시사항이 ①규정에 맞는지 검증하고, 결과를 ②PDF 파일로 저장하여 공유할 수 있습니다.' },
        { element: '#nav-label-management', title: '3-7. 표시사항 관리 : 리스트에서 조회,관리', image: "{% static 'img/tutorial/step-3-7.png' %}", description: '작성된 표시사항을 ①품목보고 여부, ②다운로드, 수정, 삭제, 를 확인할 수 있습니다.' }    ];

    let currentStep = 0;
    let highlightedElement = null;

    function createProgressBar() {
        progressBar.innerHTML = '';
        tutorialSteps.forEach((_, index) => {
            const dot = document.createElement('div');
            dot.classList.add('progress-dot');
            dot.dataset.index = index;
            dot.addEventListener('click', () => showStep(index));
            progressBar.appendChild(dot);
        });
    }

    function showStep(stepIndex) {
        if (stepIndex < 0 || stepIndex >= tutorialSteps.length) {
            return;
        }
        currentStep = stepIndex;
        const step = tutorialSteps[stepIndex];

        if (highlightedElement) {
            highlightedElement.classList.remove('tutorial-highlight');
        }
        const targetElement = document.querySelector(step.element);
        if (targetElement) {
            highlightedElement = targetElement;
            targetElement.classList.add('tutorial-highlight');
        }

        titleEl.textContent = step.title;
        imageEl.src = step.image;
        descriptionEl.textContent = step.description;

        prevBtn.style.display = stepIndex > 0 ? 'block' : 'none';
        nextBtn.style.display = stepIndex < tutorialSteps.length - 1 ? 'block' : 'none';

        document.querySelectorAll('.progress-dot').forEach((dot, index) => {
            dot.classList.toggle('active', index === currentStep);
        });
    }

    function handleKeyPress(e) {
        if (e.key === 'ArrowRight') {
            showStep(currentStep + 1);
        } else if (e.key === 'ArrowLeft') {
            showStep(currentStep - 1);
        } else if (e.key === 'Escape') {
            endTutorial();
        }
    }

    function startTutorial(e) {
        e.preventDefault();
        createProgressBar();
        overlay.style.display = 'flex';
        document.addEventListener('keydown', handleKeyPress);
        showStep(0);
    }

    function endTutorial() {
        overlay.style.display = 'none';
        if (highlightedElement) {
            highlightedElement.classList.remove('tutorial-highlight');
            highlightedElement = null;
        }
        document.removeEventListener('keydown', handleKeyPress);
        currentStep = 0;
    }

    startBtn.addEventListener('click', startTutorial);
    closeBtn.addEventListener('click', endTutorial);
    nextBtn.addEventListener('click', () => showStep(currentStep + 1));
    prevBtn.addEventListener('click', () => showStep(currentStep - 1));
});
</script>

{% endblock %}