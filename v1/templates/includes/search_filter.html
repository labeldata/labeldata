{% url action_url as target_url %}
<form method="get" action="{{ target_url }}" style="width:100%;max-width:100%;">
  <div class="search-filter-row d-flex align-items-center mb-3" style="font-size: 0.8rem; width:100%; max-width:100%;">
    <div class="search-filter-inner d-flex align-items-center flex-nowrap gap-2 w-100 justify-content-between" style="font-size: 0.8rem; width:100%; max-width:100%; overflow-x:auto;">
      {% if page_type == "product" %}
        <div style="min-width:110px;max-width:120px;flex:0 0 120px;">
          <select name="food_category" id="foodCategorySelect" class="form-select" style="font-size: 0.8rem;"
            onchange="this.form.submit()">
            <option value="domestic" {% if food_category == "domestic" %}selected{% endif %}>국내제품</option>
            <option value="imported" {% if food_category == "imported" %}selected{% endif %}>수입제품</option>
          </select>
        </div>
        {% if food_category == "imported" %}
          <input type="text" name="prdlst_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="제품명" value="{{ search_values.prdlst_nm|default_if_none:'' }}">
          <input type="text" name="prdlst_dcnm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="식품유형" value="{{ search_values.prdlst_dcnm|default_if_none:'' }}">
          <input type="text" name="xport_ntncd_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="수출국" value="{{ search_values.xport_ntncd_nm|default_if_none:'' }}">
          <input type="text" name="bsn_ofc_name" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="수입업체" value="{{ search_values.bsn_ofc_name|default_if_none:'' }}">
          <input type="text" name="bssh_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="제조사명" value="{{ search_values.bssh_nm|default_if_none:'' }}">
          <input type="text" name="pog_daycnt" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="소비기한" value="{{ search_values.pog_daycnt|default_if_none:'' }}">
          <input type="text" name="rawmtrl_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="원재료명" value="{{ search_values.rawmtrl_nm|default_if_none:'' }}">
        {% else %}
          <input type="text" name="prdlst_report_no" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="품목보고번호" value="{{ search_values.prdlst_report_no|default_if_none:'' }}">
          <input type="text" name="prdlst_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="제품명" value="{{ search_values.prdlst_nm|default_if_none:'' }}">
          <input type="text" name="prdlst_dcnm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="식품유형" value="{{ search_values.prdlst_dcnm|default_if_none:'' }}">
          <input type="text" name="bssh_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="제조사명" value="{{ search_values.bssh_nm|default_if_none:'' }}">
          <input type="text" name="pog_daycnt" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="소비기한" value="{{ search_values.pog_daycnt|default_if_none:'' }}">
          <input type="text" name="frmlc_mtrqlt" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="포장재질" value="{{ search_values.frmlc_mtrqlt|default_if_none:'' }}">
          <input type="text" name="rawmtrl_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="원재료명" value="{{ search_values.rawmtrl_nm|default_if_none:'' }}">
        {% endif %}
      {% elif page_type == "ingredient" %}
        <div style="min-width:110px;max-width:120px;flex:0 0 120px;">
          <select name="food_category" id="foodCategorySelect" class="form-select" style="font-size: 0.8rem;"
            onchange="this.form.submit()">
            <option value="" {% if not food_category %}selected{% endif %}>구분 전체</option>
            <option value="processed" {% if food_category == "processed" %}selected{% endif %}>가공식품</option>
            <option value="additive" {% if food_category == "additive" %}selected{% endif %}>식품첨가물</option>
            <option value="agricultural" {% if food_category == "agricultural" %}selected{% endif %}>농수산물</option>
          </select>
        </div>
        <input type="text" name="prdlst_report_no" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="품목보고번호" value="{{ search_values.prdlst_report_no|default_if_none:'' }}">
        <input type="text" name="prdlst_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="원재료명" value="{{ search_values.prdlst_nm|default_if_none:'' }}">
        <input type="text" name="prdlst_dcnm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="식품유형" value="{{ search_values.prdlst_dcnm|default_if_none:'' }}">
        <input type="text" name="bssh_nm" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="제조사명" value="{{ search_values.bssh_nm|default_if_none:'' }}">
        <input type="text" name="ingredient_display_name" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="원료 표시명" value="{{ search_values.ingredient_display_name|default_if_none:'' }}">
        <input type="text" name="allergens" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="알레르기" value="{{ search_values.allergens|default_if_none:'' }}">
        <input type="text" name="gmo" class="form-control flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;" placeholder="GMO" value="{{ search_values.gmo|default_if_none:'' }}">
      {% elif page_type == "label" %}
        <select name="prdlst_report_status" class="form-select flex-grow-1" style="font-size: 0.8rem; min-width:110px; max-width:180px;">
          <option value="">품보 신고 전체</option>
          <option value="completed" {% if search_values.prdlst_report_status == "completed" %}selected{% endif %}>신고 완료</option>
          <option value="pending" {% if search_values.prdlst_report_status == "pending" %}selected{% endif %}>신고 대기</option>
          <option value="none" {% if search_values.prdlst_report_status == "none" %}selected{% endif %}>번호 미등록</option>
        </select>
        <input type="text" name="my_label_name" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="라벨명" value="{{ search_values.my_label_name|default_if_none:'' }}">
        <input type="text" name="prdlst_nm" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="제품명" value="{{ search_values.prdlst_nm|default_if_none:'' }}">
        <input type="text" name="prdlst_dcnm" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="식품유형" value="{{ search_values.prdlst_dcnm|default_if_none:'' }}">
        <input type="text" name="prdlst_report_no" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="품목보고번호" value="{{ search_values.prdlst_report_no|default_if_none:'' }}">
        <input type="text" name="bssh_nm" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="제조사명" value="{{ search_values.bssh_nm|default_if_none:'' }}">
        <input type="text" name="storage_method" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="보관조건" value="{{ search_values.storage_method|default_if_none:'' }}">
        <input type="text" name="frmlc_mtrqlt" class="form-control flex-grow-1"
               style="font-size: 0.8rem; min-width:110px; max-width:180px;"
               placeholder="포장재질" value="{{ search_values.frmlc_mtrqlt|default_if_none:'' }}">
        <!-- 소비기한(pog_daycnt) 검색 조건은 제외 -->
      {% endif %}
      <select name="items_per_page" class="form-select" style="font-size: 0.8rem; width:110px; min-width:100px;">
        <option value="10"  {% if items_per_page == 10  %}selected{% endif %}>10개</option>
        <option value="20"  {% if items_per_page == 20  %}selected{% endif %}>20개</option>
        <option value="50"  {% if items_per_page == 50  %}selected{% endif %}>50개</option>
        <option value="100" {% if items_per_page == 100 %}selected{% endif %}>100개</option>
      </select>
      <button type="submit" class="btn btn-primary search-filter-btn ms-2" style="font-size: 0.8rem; min-width:60px;">
        검색
      </button>
      <button type="button" class="btn btn-cancel search-filter-btn ms-1" id="searchResetBtn" onclick="location.href='{{ target_url }}'" style="font-size: 0.8rem; min-width:30px; max-width:40px;">
        &#x21BA;
      </button>
    </div>
  </div>
</form>
<script>
  // 검색조건 입력값을 localStorage에 저장/복원 (검색 버튼 클릭 시)
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[action="{{ target_url }}"]');
    if (!form) return;
    // 복원
    try {
      const saved = localStorage.getItem('search_' + window.location.pathname);
      if (saved) {
        const params = JSON.parse(saved);
        for (const [k, v] of Object.entries(params)) {
          const el = form.elements[k];
          if (el) el.value = v;
        }
      }
    } catch (e) {}
    // 저장
    form.addEventListener('submit', function() {
      const params = {};
      Array.from(form.elements).forEach(el => {
        if (el.name && el.value !== undefined) params[el.name] = el.value;
      });
      localStorage.setItem('search_' + window.location.pathname, JSON.stringify(params));
    });
    // 초기화 버튼 클릭 시 localStorage 값도 삭제
    const resetBtn = document.getElementById('searchResetBtn');
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        localStorage.removeItem('search_' + window.location.pathname);
      });
    }
  });
  // 식품 구분 select의 value를 서버에서 받은 값으로 명확히 설정 (혹시라도 selected가 안 먹는 경우)
  document.addEventListener('DOMContentLoaded', function() {
    var foodCategorySelect = document.getElementById('foodCategorySelect');
    if (foodCategorySelect && "{{ food_category|escapejs }}") {
      foodCategorySelect.value = "{{ food_category|escapejs }}";
    }
  });
</script>
