{% extends "base_v2.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}


{% block content %}
<div class="container-fluid px-0">
    <div class="product-header">
        <div class="product-title">
            <i class="bi bi-star-fill text-warning"></i>
            {{ title }}
        </div>
        <a href="{% url 'products:product_explorer' %}" class="btn btn-outline-secondary">
            <i class="bi bi-grid-3x3-gap me-1"></i> 탐색기로
        </a>
    </div>

    {% if products %}
    <div class="product-card-grid">
        {% for product in products %}
        <div class="product-card">
            <div class="product-card-actions">
                <button class="btn btn-sm btn-link text-warning" onclick="toggleStar({{ product.product_id }})" title="즐겨찾기 해제">
                    <i class="bi bi-star-fill"></i>
                </button>
            </div>
            <div class="d-flex align-items-center gap-2">
                <i class="bi bi-box-seam text-primary"></i>
                <a href="{% url 'products:product_detail_new' product.product_id %}" class="text-decoration-none text-dark fw-semibold">
                    {{ product.product_name }}
                </a>
            </div>
            <div class="product-card-meta">{{ product.product_code|default:"-" }}</div>
            {% if product.description %}
            <div class="product-card-meta">{{ product.description|truncatechars:50 }}</div>
            {% endif %}
            <span class="badge bg-light text-dark border product-card-badge">
                {{ product.starred_datetime|date:"Y-m-d H:i" }}
            </span>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-star fs-1 text-muted mb-3"></i>
        <p class="text-muted">즐겨찾기한 제품이 없습니다</p>
        <p class="text-muted small">제품 목록에서 <i class="bi bi-star"></i> 아이콘을 클릭하여 즐겨찾기에 추가하세요</p>
        <a href="{% url 'products:product_explorer' %}" class="btn btn-primary">
            <i class="bi bi-grid-3x3-gap me-1"></i> 제품 탐색기 열기
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleStar(productId) {
    fetch(`/v2/products/${productId}/toggle-star/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}
</script>
{% endblock %}
